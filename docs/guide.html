<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××“×¨×™×š ××™××•×© Architect Agent | MongoDB + Render</title>
    <style>
        :root {
            --primary-color: #0088cc;
            --secondary-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --purple-color: #9b59b6;
            --dark-bg: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #eee;
            --code-bg: #0f0f23;
            --border-color: #3d5a80;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #0f0f23 100%);
            color: var(--text-color);
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, #005577 100%);
            margin-bottom: 40px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 40px rgba(0, 136, 204, 0.3);
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
            margin: 5px;
        }

        .badge-primary { background: #0088cc; }
        .badge-success { background: #2ecc71; }
        .badge-warning { background: #f39c12; }
        .badge-purple { background: #9b59b6; }
        .badge-danger { background: #e74c3c; }

        section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 35px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
        }

        h2 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h3 {
            color: var(--secondary-color);
            font-size: 1.3em;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: var(--warning-color);
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
        }

        code {
            background: var(--code-bg);
            padding: 3px 8px;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #7fdbca;
        }

        pre {
            background: var(--code-bg);
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            direction: ltr;
            text-align: left;
        }

        pre code {
            padding: 0;
            background: none;
            color: #c3cee3;
            line-height: 1.6;
        }

        .comment { color: #6a9955; }
        .keyword { color: #c586c0; }
        .string { color: #ce9178; }
        .function { color: #dcdcaa; }
        .variable { color: #9cdcfe; }
        .number { color: #b5cea8; }
        .decorator { color: #d7ba7d; }
        .class-name { color: #4ec9b0; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--code-bg);
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(0, 136, 204, 0.1);
        }

        .alert-box {
            display: flex;
            gap: 15px;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            align-items: flex-start;
        }

        .alert-info {
            background: rgba(0, 136, 204, 0.15);
            border-right: 4px solid var(--primary-color);
        }

        .alert-success {
            background: rgba(46, 204, 113, 0.15);
            border-right: 4px solid var(--secondary-color);
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.15);
            border-right: 4px solid var(--warning-color);
        }

        .alert-danger {
            background: rgba(231, 76, 60, 0.15);
            border-right: 4px solid var(--danger-color);
        }

        .toc {
            background: var(--code-bg);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .toc li:last-child {
            border-bottom: none;
        }

        .toc a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s;
        }

        .toc a:hover {
            color: var(--secondary-color);
        }

        .file-tree {
            background: var(--code-bg);
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            direction: ltr;
            text-align: left;
            line-height: 1.8;
            white-space: pre;
            overflow-x: auto;
        }

        .file-tree .folder { color: #f39c12; }
        .file-tree .file { color: #3498db; }
        .file-tree .special { color: #2ecc71; }

        .architecture-diagram {
            background: var(--code-bg);
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
            direction: ltr;
            text-align: center;
            font-family: monospace;
            font-size: 0.95em;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre;
            color: #c3cee3;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: var(--code-bg);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .feature-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .node-card {
            background: var(--code-bg);
            padding: 20px;
            border-radius: 10px;
            border-right: 4px solid var(--secondary-color);
            margin: 15px 0;
        }

        .node-card h4 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .adr-card {
            background: var(--code-bg);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            margin: 20px 0;
        }

        .adr-card h4 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        ul, ol {
            margin: 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-left: 10px;
        }

        .env-table td:first-child {
            font-family: monospace;
            color: #7fdbca;
            direction: ltr;
        }

        .flow-diagram {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: var(--code-bg);
            border-radius: 10px;
            margin: 20px 0;
        }

        .flow-step {
            background: var(--card-bg);
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
            min-width: 120px;
        }

        .flow-arrow {
            display: flex;
            align-items: center;
            color: var(--primary-color);
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }

            section {
                padding: 20px;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .flow-diagram {
                flex-direction: column;
                align-items: center;
            }

            .flow-arrow {
                transform: rotate(90deg);
            }
        }

        /* ×›×¤×ª×•×¨ ×”×¢×ª×§×” ×œ×‘×œ×•×§×™ ×§×•×“ */
        .code-block {
            position: relative;
            overflow: visible;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 100;
            background: rgba(60, 60, 80, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 10px;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s, background 0.2s;
            color: #ccc;
            font-size: 14px;
            line-height: 1;
        }

        .code-block:hover .copy-btn {
            opacity: 1;
            visibility: visible;
        }

        .copy-btn:hover {
            background: rgba(100, 100, 120, 1);
            color: #fff;
        }

        .copy-btn:active {
            background: rgba(46, 204, 113, 0.7);
            transform: scale(0.95);
        }

        .copy-btn.copied {
            background: rgba(46, 204, 113, 0.7);
            color: #fff;
        }

        /* ××™×™×§×•×Ÿ ×”×¢×ª×§×” SVG */
        .copy-btn svg {
            width: 16px;
            height: 16px;
            vertical-align: middle;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ—ï¸ Architect Agent</h1>
        <p>××“×¨×™×š ××™××•×© ××œ× ×œ×¡×•×›×Ÿ AI ×œ×ª×›× ×•×Ÿ ××¨×›×™×˜×§×˜×•×¨×ª ×ª×•×›× ×”</p>
        <div>
            <span class="badge badge-primary">Python 3.11+</span>
            <span class="badge badge-success">MongoDB</span>
            <span class="badge badge-warning">LangGraph</span>
            <span class="badge badge-purple">Claude API</span>
            <span class="badge badge-danger">Render</span>
        </div>
    </header>

    <div class="container">
        <nav class="toc">
            <h3>ğŸ“‘ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×</h3>
            <ul>
                <li><a href="#overview">1. ×¡×§×™×¨×” ×›×œ×œ×™×ª</a></li>
                <li><a href="#architecture">2. ××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª</a></li>
                <li><a href="#project-structure">3. ××‘× ×” ×”×¤×¨×•×™×§×˜</a></li>
                <li><a href="#data-models">4. ××•×“×œ×™× ×•-Schema</a></li>
                <li><a href="#nodes">5. Nodes - ×¦××ª×™ ×”×¢×™×‘×•×“</a></li>
                <li><a href="#graph">6. ×”×’×“×¨×ª ×”-Graph</a></li>
                <li><a href="#mongodb">7. ×©×›×‘×ª MongoDB</a></li>
                <li><a href="#api">8. API Endpoints</a></li>
                <li><a href="#config">9. ×§×•× ×¤×™×’×•×¨×¦×™×” ×•-Environment</a></li>
                <li><a href="#render">10. ×¤×¨×™×¡×” ×‘-Render</a></li>
                <li><a href="#adrs">11. ADRs - ×”×—×œ×˜×•×ª ××¨×›×™×˜×§×˜×•× ×™×•×ª</a></li>
                <li><a href="#best-practices">12. Best Practices ×•×˜×™×¤×™×</a></li>
            </ul>
        </nav>

        <!-- Section 1: Overview -->
        <section id="overview">
            <h2>ğŸ“Š 1. ×¡×§×™×¨×” ×›×œ×œ×™×ª</h2>

            <p>
                <strong>Architect Agent</strong> ×”×•× ×¡×•×›×Ÿ AI ××‘×•×¡×¡ LangGraph ×©××“××” ×ª×”×œ×™×š ×—×©×™×‘×” ×©×œ ××¨×›×™×˜×§×˜ ×ª×•×›× ×” ×× ×•×¡×”.
                ×”×¡×•×›×Ÿ ×× ×ª×— ×“×¨×™×©×•×ª ×¤×¨×•×™×§×˜, ××–×”×” ×¡×ª×™×¨×•×ª, ××¦×™×¢ ××¨×›×™×˜×§×˜×•×¨×” ××ª××™××” ×•××™×™×¦×¨ Blueprint ××§×¦×•×¢×™.
            </p>

            <h3>ğŸ¯ ××” ×”×¡×•×›×Ÿ ×¢×•×©×”</h3>
            <ul>
                <li>×× ×ª×— ×“×¨×™×©×•×ª ×¤×¨×•×™×§×˜ ×“×¨×š ×©×™×—×” ××™× ×˜×¨××§×˜×™×‘×™×ª</li>
                <li>××–×”×” ×§×•× ×¤×œ×™×§×˜×™× ×‘×™×Ÿ ×“×¨×™×©×•×ª ×•××¦×™×¢ ×¤×©×¨×•×ª</li>
                <li>×‘×•×—×¨ Pattern ××¨×›×™×˜×§×˜×•× ×™ ××ª××™× (Monolith, Microservices, Serverless)</li>
                <li>×××œ×™×¥ ×¢×œ Technology Stack ××•×ª××</li>
                <li>××¢×¨×™×š ×¢×œ×•×™×•×ª ×•××•×¨×›×‘×•×ª ×ª×¤×¢×•×œ×™×ª</li>
                <li>××™×™×¦×¨ Blueprint ××§×¦×•×¢×™ ×¢× ×“×™××’×¨××•×ª</li>
            </ul>

            <h3>ğŸ”„ ×–×¨×™××ª ×”×¢×‘×•×“×”</h3>
            <div class="flow-diagram">
                <div class="flow-step">ğŸ“<br>Intake</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">âš–ï¸<br>Priority</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">âš ï¸<br>Conflicts</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">ğŸ”<br>Deep Dive</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">ğŸ—ï¸<br>Pattern</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">ğŸ’°<br>Feasibility</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">ğŸ“„<br>Blueprint</div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">ğŸ”<br>Critic</div>
            </div>

            <div class="alert-box alert-info">
                <span style="font-size: 1.5em;">ğŸ’¡</span>
                <div>
                    <strong>×¢×™×§×¨×•×Ÿ ×× ×—×”:</strong> ×”×¡×•×›×Ÿ ×¤×•×¢×œ ×‘××•×¤×Ÿ ××™×˜×¨×˜×™×‘×™ - ×× ×”-Critic ××–×”×” ×‘×¢×™×•×ª,
                    ×”××¢×¨×›×ª ×—×•×–×¨×ª ×œ×©×œ×‘×™× ×§×•×“××™× ×œ×“×™×•×§ × ×•×¡×£. ××§×¡×™××•× 5 ××™×˜×¨×¦×™×•×ª.
                </div>
            </div>
        </section>

        <!-- Section 2: Architecture -->
        <section id="architecture">
            <h2>ğŸ›ï¸ 2. ××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª</h2>

            <h3>×“×™××’×¨××ª ×¨×›×™×‘×™×</h3>
            <div class="architecture-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   Web App    â”‚  â”‚   CLI Tool   â”‚  â”‚  Telegram    â”‚                       â”‚
â”‚  â”‚   (React)    â”‚  â”‚   (Typer)    â”‚  â”‚     Bot      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚
          â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API LAYER (FastAPI)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /api/v1/sessions    /api/v1/chat    /api/v1/blueprints              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AGENT LAYER (LangGraph)                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Intake    â”‚â”€â”€â”€â–¶â”‚  Priority  â”‚â”€â”€â”€â–¶â”‚  Conflict  â”‚â”€â”€â”€â–¶â”‚ Deep Dive  â”‚      â”‚
â”‚  â”‚   Node     â”‚    â”‚   Node     â”‚    â”‚   Node     â”‚    â”‚   Node     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚              â”‚
â”‚  â”‚  Critic    â”‚â—€â”€â”€â”€â”‚ Blueprint  â”‚â—€â”€â”€â”€â”‚ Feasibilityâ”‚â—€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”‚   Node     â”‚    â”‚   Node     â”‚    â”‚   Node     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚        â”‚                                                                    â”‚
â”‚        â”‚ (if confidence < 0.7)                                              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Back to earlier nodes  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATA LAYER                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚     MongoDB      â”‚  â”‚      Redis       â”‚  â”‚   Claude API     â”‚          â”‚
â”‚  â”‚   (Sessions,     â”‚  â”‚    (Cache,       â”‚  â”‚   (Reasoning)    â”‚          â”‚
â”‚  â”‚   Blueprints)    â”‚  â”‚     Locks)       â”‚  â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>

            <h3>×¨×›×™×‘×™× ×¢×™×§×¨×™×™×</h3>
            <div class="grid-2">
                <div class="feature-card">
                    <h4>ğŸŒ API Layer</h4>
                    <p>FastAPI ×¢× async support ××œ×. ××¡×¤×§ endpoints ×œ-REST ×•-WebSocket ×œ×ª×§×©×•×¨×ª real-time ×¢× ×”×¡×•×›×Ÿ.</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ§  Agent Layer</h4>
                    <p>LangGraph ×œ× ×™×”×•×œ ×”-State ×•×–×¨×™××ª ×”×¢×‘×•×“×”. ×›×œ Node ×”×•× ×¤×•× ×§×¦×™×” ×©××§×‘×œ×ª ×•××—×–×™×¨×” ProjectContext.</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ—„ï¸ MongoDB</h4>
                    <p>×©××™×¨×ª Sessions, Blueprints, ×•×™×“×¢ ××¦×˜×‘×¨. ×ª×•××š ×‘-TTL indexes ×œ× ×™×§×•×™ ××•×˜×•××˜×™.</p>
                </div>
                <div class="feature-card">
                    <h4>âš¡ Redis</h4>
                    <p>Cache ×œ×ª×‘× ×™×•×ª × ×¤×•×¦×•×ª ×•-rate limiting. ××•×¤×¦×™×•× ×œ×™ ××‘×œ ××•××œ×¥ ×œ×‘×™×¦×•×¢×™×.</p>
                </div>
            </div>
        </section>

        <!-- Section 3: Project Structure -->
        <section id="project-structure">
            <h2>ğŸ“ 3. ××‘× ×” ×”×¤×¨×•×™×§×˜</h2>

            <div class="file-tree">
<span class="folder">architect-agent/</span>
â”œâ”€â”€ <span class="folder">src/</span>
â”‚   â”œâ”€â”€ <span class="folder">agent/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">__init__.py</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">graph.py</span>              <span class="comment"># ×”×’×“×¨×ª ×”-LangGraph</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">state.py</span>              <span class="comment"># ProjectContext ×•-State</span>
â”‚   â”‚   â””â”€â”€ <span class="folder">nodes/</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">__init__.py</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">intake.py</span>         <span class="comment"># ××™×¡×•×£ ×“×¨×™×©×•×ª ×¨××©×•× ×™</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">priority.py</span>       <span class="comment"># ×™×™×©×•×¨ ×¢×“×™×¤×•×™×•×ª</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">conflict.py</span>       <span class="comment"># ×–×™×”×•×™ ×¡×ª×™×¨×•×ª</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">deep_dive.py</span>      <span class="comment"># ×”×¢××§×” ×‘×ª×—×•××™×</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">pattern.py</span>        <span class="comment"># ×‘×—×™×¨×ª Pattern</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">feasibility.py</span>    <span class="comment"># ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª</span>
â”‚   â”‚       â”œâ”€â”€ <span class="file">blueprint.py</span>      <span class="comment"># ×™×¦×™×¨×ª ××¡××š</span>
â”‚   â”‚       â””â”€â”€ <span class="file">critic.py</span>         <span class="comment"># ×‘×™×§×•×¨×ª ×•×‘×§×¨×”</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">api/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">__init__.py</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">main.py</span>               <span class="comment"># FastAPI app</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">routes.py</span>             <span class="comment"># API endpoints</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">websocket.py</span>          <span class="comment"># Real-time chat</span>
â”‚   â”‚   â””â”€â”€ <span class="file">deps.py</span>               <span class="comment"># Dependencies</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">db/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">__init__.py</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">mongodb.py</span>            <span class="comment"># MongoDB client</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">repositories.py</span>       <span class="comment"># Data access layer</span>
â”‚   â”‚   â””â”€â”€ <span class="file">models.py</span>             <span class="comment"># MongoDB schemas</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">llm/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">__init__.py</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">client.py</span>             <span class="comment"># Claude API wrapper</span>
â”‚   â”‚   â””â”€â”€ <span class="file">prompts.py</span>            <span class="comment"># System prompts</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">knowledge/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">patterns.py</span>           <span class="comment"># Architectural patterns</span>
â”‚   â”‚   â”œâ”€â”€ <span class="file">tech_stacks.py</span>        <span class="comment"># Technology recommendations</span>
â”‚   â”‚   â””â”€â”€ <span class="file">decision_matrix.py</span>   <span class="comment"># Scoring logic</span>
â”‚   â”‚
â”‚   â””â”€â”€ <span class="file">config.py</span>                 <span class="comment"># Settings ×•-env vars</span>
â”‚
â”œâ”€â”€ <span class="folder">tests/</span>
â”‚   â”œâ”€â”€ <span class="file">test_nodes.py</span>
â”‚   â”œâ”€â”€ <span class="file">test_graph.py</span>
â”‚   â””â”€â”€ <span class="file">test_api.py</span>
â”‚
â”œâ”€â”€ <span class="special">requirements.txt</span>
â”œâ”€â”€ <span class="special">render.yaml</span>                   <span class="comment"># Render configuration</span>
â”œâ”€â”€ <span class="special">Dockerfile</span>
â””â”€â”€ <span class="special">.env.example</span>
            </div>

            <div class="alert-box alert-success">
                <span style="font-size: 1.5em;">âœ…</span>
                <div>
                    <strong>××¨×›×™×˜×§×˜×•×¨×” ××•×“×•×œ×¨×™×ª:</strong> ×›×œ ×¨×›×™×‘ ×¢×¦×××™ ×•× ×™×ª×Ÿ ×œ×‘×“×™×§×” ×‘× ×¤×¨×“.
                    ×”-Nodes × ×¤×¨×“×™× ××œ×•×’×™×§×ª ×”-Graph, ×•×©×›×‘×ª ×”-DB ××•×¤×¨×“×ª ××”×¡×•×›×Ÿ.
                </div>
            </div>
        </section>

        <!-- Section 4: Data Models -->
        <section id="data-models">
            <h2>ğŸ“‹ 4. ××•×“×œ×™× ×•-Schema</h2>

            <h3>state.py - ××•×“×œ ×”-State ×”××¨×›×–×™</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">typing</span> <span class="keyword">import</span> List, Dict, Optional, Literal
<span class="keyword">from</span> <span class="variable">pydantic</span> <span class="keyword">import</span> BaseModel, Field
<span class="keyword">from</span> <span class="variable">datetime</span> <span class="keyword">import</span> datetime
<span class="keyword">from</span> <span class="variable">enum</span> <span class="keyword">import</span> Enum


<span class="keyword">class</span> <span class="class-name">Priority</span>(str, Enum):
    <span class="string">"""×¢×“×™×¤×•×™×•×ª ×œ×“×™×¨×•×’"""</span>
    HIGH = <span class="string">"high"</span>
    MEDIUM = <span class="string">"medium"</span>
    LOW = <span class="string">"low"</span>
    CRITICAL = <span class="string">"critical"</span>


<span class="keyword">class</span> <span class="class-name">DecisionProfile</span>(str, Enum):
    <span class="string">"""×¤×¨×•×¤×™×œ×™ ×”×—×œ×˜×” ××•×›× ×™×"""</span>
    MVP_FAST = <span class="string">"mvp_fast"</span>          <span class="comment"># ××”×™×¨×•×ª ××¢×œ ×”×›×œ</span>
    COST_FIRST = <span class="string">"cost_first"</span>      <span class="comment"># ×—×™×¡×›×•×Ÿ ×‘×¢×œ×•×™×•×ª</span>
    SCALE_FIRST = <span class="string">"scale_first"</span>    <span class="comment"># ×¡×§×™×™×œ ×¢×ª×™×“×™</span>
    SECURITY_FIRST = <span class="string">"security_first"</span>  <span class="comment"># ××‘×˜×—×” ×•×¦×™×•×ª</span>


<span class="keyword">class</span> <span class="class-name">CostBand</span>(str, Enum):
    <span class="string">"""×¨××•×ª ×¢×œ×•×ª"""</span>
    LOW = <span class="string">"low"</span>        <span class="comment"># ×¢×“ $500/×—×•×“×©</span>
    MEDIUM = <span class="string">"medium"</span>  <span class="comment"># $500-$5000/×—×•×“×©</span>
    HIGH = <span class="string">"high"</span>      <span class="comment"># ××¢×œ $5000/×—×•×“×©</span>


<span class="keyword">class</span> <span class="class-name">Requirement</span>(BaseModel):
    <span class="string">"""×“×¨×™×©×” ×‘×•×“×“×ª"""</span>
    category: Literal[<span class="string">"functional"</span>, <span class="string">"non_functional"</span>]
    description: str
    priority: Priority = Priority.MEDIUM
    value: Optional[str] = <span class="keyword">None</span>  <span class="comment"># ×œ××©×œ: "100k users"</span>
    source: str = <span class="string">"user"</span>  <span class="comment"># ×××™×¤×” ×”×’×™×¢×” ×”×“×¨×™×©×”</span>


<span class="keyword">class</span> <span class="class-name">Constraint</span>(BaseModel):
    <span class="string">"""××™×œ×•×¥"""</span>
    type: Literal[<span class="string">"technical"</span>, <span class="string">"budget"</span>, <span class="string">"timeline"</span>, <span class="string">"compliance"</span>, <span class="string">"team"</span>]
    description: str
    severity: Priority = Priority.MEDIUM


<span class="keyword">class</span> <span class="class-name">Conflict</span>(BaseModel):
    <span class="string">"""×¡×ª×™×¨×” ××–×•×”×”"""</span>
    requirements: List[str]  <span class="comment"># ×ª×™××•×¨×™ ×”×“×¨×™×©×•×ª ×”×¡×•×ª×¨×•×ª</span>
    explanation: str         <span class="comment"># ×œ××” ×–×• ×¡×ª×™×¨×”</span>
    compromises: List[str]   <span class="comment"># 2-3 ××¡×œ×•×œ×™ ×¤×©×¨×”</span>
    resolved: bool = <span class="keyword">False</span>


<span class="keyword">class</span> <span class="class-name">PriorityRanking</span>(BaseModel):
    <span class="string">"""×“×™×¨×•×’ ×¢×“×™×¤×•×™×•×ª"""</span>
    time_to_market: int = Field(ge=<span class="number">1</span>, le=<span class="number">5</span>)
    cost: int = Field(ge=<span class="number">1</span>, le=<span class="number">5</span>)
    scale: int = Field(ge=<span class="number">1</span>, le=<span class="number">5</span>)
    reliability: int = Field(ge=<span class="number">1</span>, le=<span class="number">5</span>)
    security: int = Field(ge=<span class="number">1</span>, le=<span class="number">5</span>)


<span class="keyword">class</span> <span class="class-name">ArchitecturalDecision</span>(BaseModel):
    <span class="string">"""×”×—×œ×˜×” ××¨×›×™×˜×§×˜×•× ×™×ª"""</span>
    pattern: str
    justification: str
    trade_offs: List[str]
    alternatives_considered: List[str] = Field(default_factory=list)
    score: float = <span class="number">0.0</span>  <span class="comment"># × ×™×§×•×“ 0-100</span>


<span class="keyword">class</span> <span class="class-name">TechStackComponent</span>(BaseModel):
    <span class="string">"""×¨×›×™×‘ ×‘-Stack ×”×˜×›× ×•×œ×•×’×™"""</span>
    layer: Literal[<span class="string">"frontend"</span>, <span class="string">"backend"</span>, <span class="string">"database"</span>,
                   <span class="string">"cache"</span>, <span class="string">"messaging"</span>, <span class="string">"auth"</span>,
                   <span class="string">"ci_cd"</span>, <span class="string">"monitoring"</span>, <span class="string">"cloud"</span>]
    technology: str
    reason: str
    alternatives: List[str] = Field(default_factory=list)


<span class="keyword">class</span> <span class="class-name">FeasibilityAssessment</span>(BaseModel):
    <span class="string">"""×”×¢×¨×›×ª ×”×™×ª×›× ×•×ª"""</span>
    cost_band: CostBand
    ops_complexity: CostBand
    cost_drivers: List[str]      <span class="comment"># ××” ××™×™×§×¨</span>
    cost_reducers: List[str]     <span class="comment"># ××” ××•×–×™×œ</span>
    team_fit: bool               <span class="comment"># ××ª××™× ×œ×™×›×•×œ×•×ª ×”×¦×•×•×ª?</span>
    time_estimate: str           <span class="comment"># ×”×¢×¨×›×ª ×–××Ÿ ×’×¡×”</span>


<span class="keyword">class</span> <span class="class-name">ADR</span>(BaseModel):
    <span class="string">"""Architecture Decision Record"""</span>
    id: str                      <span class="comment"># ADR-001</span>
    title: str
    context: str
    decision: str
    consequences: List[str]


<span class="keyword">class</span> <span class="class-name">Blueprint</span>(BaseModel):
    <span class="string">"""×ª×•×¦×¨ ×¡×•×¤×™ - ××¡××š ×”-Blueprint"""</span>
    executive_summary: str
    mermaid_diagram: str
    adrs: List[ADR]
    roadmap: Dict[str, List[str]]  <span class="comment"># phase -> tasks</span>
    next_steps: List[str]
    assumptions: List[str]
    unknowns: List[str]


<span class="keyword">class</span> <span class="class-name">ProjectContext</span>(BaseModel):
    <span class="string">"""
    ×”-State ×”××¨×›×–×™ ×©×œ ×”×¡×•×›×Ÿ.
    ×›×œ ×”-Nodes ×§×•×¨××™× ×•×›×•×ª×‘×™× ×œ××•×“×œ ×”×–×”.
    """</span>
    <span class="comment"># ××–×”×™×</span>
    session_id: str
    project_name: Optional[str] = <span class="keyword">None</span>
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)

    <span class="comment"># ×“×¨×™×©×•×ª ×•××™×œ×•×¦×™×</span>
    initial_summary: Optional[str] = <span class="keyword">None</span>
    requirements: List[Requirement] = Field(default_factory=list)
    constraints: List[Constraint] = Field(default_factory=list)

    <span class="comment"># ×¢×“×™×¤×•×™×•×ª</span>
    decision_profile: Optional[DecisionProfile] = <span class="keyword">None</span>
    priority_ranking: Optional[PriorityRanking] = <span class="keyword">None</span>

    <span class="comment"># ×§×•× ×¤×œ×™×§×˜×™×</span>
    conflicts: List[Conflict] = Field(default_factory=list)

    <span class="comment"># ×”×—×œ×˜×•×ª</span>
    proposed_architecture: Optional[ArchitecturalDecision] = <span class="keyword">None</span>
    shortlist: List[ArchitecturalDecision] = Field(default_factory=list)
    tech_stack: List[TechStackComponent] = Field(default_factory=list)
    feasibility: Optional[FeasibilityAssessment] = <span class="keyword">None</span>

    <span class="comment"># ×ª×•×¦×¨</span>
    blueprint: Optional[Blueprint] = <span class="keyword">None</span>

    <span class="comment"># ××˜×-×“××˜×” ×œ× ×™×”×•×œ</span>
    conversation_history: List[Dict[str, str]] = Field(default_factory=list)
    current_node: str = <span class="string">"intake"</span>
    open_questions: List[str] = Field(default_factory=list)
    confidence_score: float = <span class="number">0.0</span>
    iteration_count: int = <span class="number">0</span>
    max_iterations: int = <span class="number">5</span>

    <span class="comment"># ---- Revision Tracking (×œ×× ×™×¢×ª ×œ×•×¤×™×) ----</span>
    revision_count: int = <span class="number">0</span>
    last_pattern: Optional[str] = <span class="keyword">None</span>
    last_confidence_reason: Optional[str] = <span class="keyword">None</span>
    waiting_for_user: bool = <span class="keyword">False</span>

    <span class="keyword">def</span> <span class="function">add_message</span>(self, role: str, content: str):
        <span class="string">"""×”×•×¡×¤×ª ×”×•×“×¢×” ×œ×”×™×¡×˜×•×¨×™×”"""</span>
        self.conversation_history.append({
            <span class="string">"role"</span>: role,
            <span class="string">"content"</span>: content,
            <span class="string">"timestamp"</span>: datetime.utcnow().isoformat()
        })
        self.updated_at = datetime.utcnow()

    <span class="keyword">def</span> <span class="function">is_done</span>(self) -> bool:
        <span class="string">"""×”×× ×”×¡×•×›×Ÿ ×¡×™×™×?"""</span>
        <span class="keyword">return</span> (
            self.blueprint <span class="keyword">is not</span> <span class="keyword">None</span> <span class="keyword">and</span>
            self.confidence_score >= <span class="number">0.7</span> <span class="keyword">and</span>
            len(self.blueprint.adrs) >= <span class="number">3</span>
        )

    <span class="keyword">def</span> <span class="function">has_unresolved_conflicts</span>(self) -> bool:
        <span class="string">"""×”×× ×™×© ×§×•× ×¤×œ×™×§×˜×™× ×©×œ× × ×¤×ª×¨×•?"""</span>
        <span class="keyword">return</span> <span class="keyword">any</span>(
            c.resolution <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> c.resolution == <span class="string">""</span>
            <span class="keyword">for</span> c <span class="keyword">in</span> self.conflicts
        )</code></pre>

            <div class="alert-box alert-warning">
                <span style="font-size: 1.5em;">âš ï¸</span>
                <div>
                    <strong>×—×©×•×‘:</strong> ×”-<code>ProjectContext</code> ×”×•× Immutable ×œ××¢×˜ ×“×¨×š methods ××•×’×“×¨×™×.
                    ×›×œ Node ××—×–×™×¨ context ×—×“×© (××• ××©×ª××© ×‘-methods ×›××• <code>add_message</code>).
                </div>
            </div>
        </section>

        <!-- Section 5: Nodes -->
        <section id="nodes">
            <h2>ğŸ”— 5. Nodes - ×¦××ª×™ ×”×¢×™×‘×•×“</h2>

            <p>
                ×›×œ Node ×”×•× ×¤×•× ×§×¦×™×” async ×©××§×‘×œ×ª <code>ProjectContext</code> ×•××—×–×™×¨×” <code>ProjectContext</code> ××¢×•×“×›×Ÿ.
                ×”× ×” ×”××™××•×© ×©×œ ×›×œ Node:
            </p>

            <h3>nodes/intake.py - ××™×¡×•×£ ×“×¨×™×©×•×ª</h3>
            <div class="node-card">
                <h4>ğŸ“ IntakeNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×§×‘×œ ×ª×™××•×¨ ×¨××©×•× ×™ ×•×œ×”×•×¦×™× ×©××œ×•×ª Impact-high ×‘×œ×‘×“.</p>
                <p><strong>×§×œ×˜:</strong> ×”×•×“×¢×” ×¨××©×•× ×™×ª ××”××©×ª××©</p>
                <p><strong>×¤×œ×˜:</strong> ×ª×§×¦×™×¨, ×¨×©×™××ª ×“×¨×™×©×•×ª ×¨××©×•× ×™×ª, 3-5 ×©××œ×•×ª ×××•×§×“×•×ª</p>
            </div>
            <pre><code><span class="keyword">from</span> <span class="variable">typing</span> <span class="keyword">import</span> Tuple
<span class="keyword">from</span> <span class="variable">..state</span> <span class="keyword">import</span> ProjectContext, Requirement, Constraint
<span class="keyword">from</span> <span class="variable">..llm.client</span> <span class="keyword">import</span> LLMClient
<span class="keyword">from</span> <span class="variable">..llm.prompts</span> <span class="keyword">import</span> INTAKE_PROMPT


<span class="keyword">async def</span> <span class="function">intake_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str]:
    <span class="string">"""
    ×¦×•××ª ××™×¡×•×£ ×“×¨×™×©×•×ª ×¨××©×•× ×™.
    ×× ×ª×— ××ª ×”×”×•×“×¢×” ×”×¨××©×•× ×” ×•××—×œ×¥ ××™×“×¢ ××•×‘× ×”.
    """</span>
    <span class="comment"># ×‘× ×™×™×ª ×”-prompt</span>
    prompt = INTAKE_PROMPT.format(
        user_message=ctx.initial_summary,
        history=_format_history(ctx.conversation_history)
    )

    <span class="comment"># ×§×¨×™××” ×œ-LLM ×¢× structured output</span>
    response = <span class="keyword">await</span> llm.generate_structured(
        prompt=prompt,
        response_model=IntakeResponse
    )

    <span class="comment"># ×¢×“×›×•×Ÿ ×”-context</span>
    ctx.project_name = response.project_name
    ctx.requirements.extend(response.requirements)
    ctx.constraints.extend(response.constraints)
    ctx.open_questions = response.questions[:5]  <span class="comment"># ××§×¡×™××•× 5 ×©××œ×•×ª</span>
    ctx.confidence_score = response.confidence

    <span class="comment"># ×”×•×“×¢×ª ×ª×’×•×‘×” ×œ××©×ª××©</span>
    reply = _build_intake_reply(response)
    ctx.add_message(<span class="string">"assistant"</span>, reply)

    <span class="keyword">return</span> ctx, reply


<span class="keyword">def</span> <span class="function">_format_history</span>(history: list) -> str:
    <span class="string">"""×¤×•×¨××˜ ×”×™×¡×˜×•×¨×™×™×ª ×©×™×—×”"""</span>
    <span class="keyword">return</span> <span class="string">"\n"</span>.join([
        f<span class="string">"{msg['role']}: {msg['content']}"</span>
        <span class="keyword">for</span> msg <span class="keyword">in</span> history[-<span class="number">10</span>:]  <span class="comment"># 10 ×”×•×“×¢×•×ª ××—×¨×•× ×•×ª</span>
    ])


<span class="keyword">def</span> <span class="function">_build_intake_reply</span>(response) -> str:
    <span class="string">"""×‘× ×™×™×ª ×ª×’×•×‘×” ×œ××©×ª××©"""</span>
    parts = [
        f<span class="string">"## ğŸ“Š ×”×‘× ×ª×™ - {response.project_name}\n"</span>,
        response.summary,
        <span class="string">"\n### ×©××œ×•×ª ×œ×”×‘×”×¨×”:\n"</span>
    ]
    <span class="keyword">for</span> i, q <span class="keyword">in</span> enumerate(response.questions[:5], <span class="number">1</span>):
        parts.append(f<span class="string">"{i}. {q}"</span>)

    <span class="keyword">return</span> <span class="string">"\n"</span>.join(parts)</code></pre>

            <h3>nodes/priority.py - ×™×™×©×•×¨ ×¢×“×™×¤×•×™×•×ª</h3>
            <div class="node-card">
                <h4>âš–ï¸ PriorityNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×’×¨×•× ×œ××©×ª××© ×œ×‘×—×•×¨ ××” ×‘×××ª ×—×©×•×‘.</p>
                <p><strong>×§×œ×˜:</strong> Context ×¢× ×“×¨×™×©×•×ª ×¨××©×•× ×™×•×ª</p>
                <p><strong>×¤×œ×˜:</strong> DecisionProfile ××• PriorityRanking</p>
            </div>
            <pre><code><span class="keyword">async def</span> <span class="function">priority_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str]:
    <span class="string">"""
    ×™×™×©×•×¨ ×¢×“×™×¤×•×™×•×ª - ×©×•××œ ××ª ×”××©×ª××© ×œ×“×¨×’
    ××• ×œ×‘×—×•×¨ ×¤×¨×•×¤×™×œ ××•×›×Ÿ.
    """</span>
    <span class="comment"># ×× ×›×‘×¨ ×™×© ×¤×¨×•×¤×™×œ, ×××©×™×›×™×</span>
    <span class="keyword">if</span> ctx.decision_profile <span class="keyword">or</span> ctx.priority_ranking:
        <span class="keyword">return</span> ctx, <span class="string">""</span>

    <span class="comment"># × ×™×¡×™×•×Ÿ ×œ×–×”×•×ª ×¤×¨×•×¤×™×œ ××•×˜×•××˜×™×ª ××”×“×¨×™×©×•×ª</span>
    detected_profile = <span class="keyword">await</span> _detect_profile(ctx, llm)

    <span class="keyword">if</span> detected_profile <span class="keyword">and</span> detected_profile.confidence > <span class="number">0.8</span>:
        ctx.decision_profile = detected_profile.profile
        reply = f<span class="string">"×–×™×”×™×ª×™ ×©×”×¢×“×™×¤×•×ª ×”×¢×™×§×¨×™×ª ×©×œ×š ×”×™× **{detected_profile.profile.value}**. × ×›×•×Ÿ?"</span>
    <span class="keyword">else</span>:
        <span class="comment"># ××‘×§×© ××”××©×ª××© ×œ×‘×—×•×¨</span>
        reply = <span class="string">"""
### âš–ï¸ ×™×™×©×•×¨ ×¢×“×™×¤×•×™×•×ª

×›×“×™ ×œ×”××œ×™×¥ ×¢×œ ×”××¨×›×™×˜×§×˜×•×¨×” ×”× ×›×•× ×”, ×× ×™ ×¦×¨×™×š ×œ×”×‘×™×Ÿ ××” ×”×›×™ ×—×©×•×‘ ×œ×š.

**×‘×—×¨ ×¤×¨×•×¤×™×œ ××•×›×Ÿ:**
1. ğŸš€ **MVP_FAST** - ××”×™×¨×•×ª ××¢×œ ×”×›×œ, × ×¦× ×œ××•×•×™×¨ ××”×¨
2. ğŸ’° **COST_FIRST** - ×—×™×¡×›×•×Ÿ ×‘×¢×œ×•×™×•×ª ×”×•× ×”××¤×ª×—
3. ğŸ“ˆ **SCALE_FIRST** - ×‘×•× ×™× ×œ×’×“×•×œ, ×’× ×× ×œ×•×§×— ×™×•×ª×¨ ×–××Ÿ
4. ğŸ”’ **SECURITY_FIRST** - ××‘×˜×—×” ×•×¦×™×•×ª ×§×•×“××™× ×œ×›×œ

**××• ×“×¨×’ 1-5 (1=×œ× ×—×©×•×‘, 5=×§×¨×™×˜×™):**
- Time-to-market
- Cost
- Scale
- Reliability
- Security
"""</span>

    ctx.add_message(<span class="string">"assistant"</span>, reply)
    <span class="keyword">return</span> ctx, reply</code></pre>

            <h3>nodes/conflict.py - ×–×™×”×•×™ ×¡×ª×™×¨×•×ª</h3>
            <div class="node-card">
                <h4>âš ï¸ ConflictNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×–×”×•×ª ×“×¨×™×©×•×ª ×¡×•×ª×¨×•×ª ×•×œ×”×¦×™×¢ ×¤×©×¨×•×ª.</p>
                <p><strong>×§×œ×˜:</strong> Context ×¢× ×“×¨×™×©×•×ª ×•×¢×“×™×¤×•×™×•×ª</p>
                <p><strong>×¤×œ×˜:</strong> ×¨×©×™××ª ×§×•× ×¤×œ×™×§×˜×™× ×¢× ×¤×©×¨×•×ª ××•×¦×¢×•×ª</p>
            </div>
            <pre><code><span class="keyword">async def</span> <span class="function">conflict_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str]:
    <span class="string">"""
    ×–×™×”×•×™ ×¡×ª×™×¨×•×ª ×‘×“×¨×™×©×•×ª.
    """</span>
    prompt = CONFLICT_DETECTION_PROMPT.format(
        requirements=[r.model_dump() <span class="keyword">for</span> r <span class="keyword">in</span> ctx.requirements],
        constraints=[c.model_dump() <span class="keyword">for</span> c <span class="keyword">in</span> ctx.constraints],
        priorities=ctx.priority_ranking.model_dump() <span class="keyword">if</span> ctx.priority_ranking <span class="keyword">else</span> {}
    )

    response = <span class="keyword">await</span> llm.generate_structured(
        prompt=prompt,
        response_model=ConflictAnalysis
    )

    ctx.conflicts = response.conflicts

    <span class="keyword">if</span> <span class="keyword">not</span> ctx.conflicts:
        reply = <span class="string">"âœ… ×œ× ×–×™×”×™×ª×™ ×¡×ª×™×¨×•×ª ××©××¢×•×ª×™×•×ª ×‘×“×¨×™×©×•×ª. ×××©×™×›×™×!"</span>
    <span class="keyword">else</span>:
        reply = _build_conflict_reply(ctx.conflicts)

    ctx.add_message(<span class="string">"assistant"</span>, reply)
    <span class="keyword">return</span> ctx, reply


<span class="keyword">def</span> <span class="function">_build_conflict_reply</span>(conflicts: list) -> str:
    <span class="string">"""×‘× ×™×™×ª ×ª×’×•×‘×” ×¢× ×§×•× ×¤×œ×™×§×˜×™×"""</span>
    parts = [<span class="string">"### âš ï¸ ×–×™×”×™×ª×™ ×¡×ª×™×¨×•×ª ×‘×“×¨×™×©×•×ª:\n"</span>]

    <span class="keyword">for</span> i, conflict <span class="keyword">in</span> enumerate(conflicts, <span class="number">1</span>):
        parts.append(f<span class="string">"""
**×§×•× ×¤×œ×™×§×˜ #{i}:** {conflict.explanation}
- ×“×¨×™×©×•×ª ×¡×•×ª×¨×•×ª: {', '.join(conflict.requirements)}
- ×¤×©×¨×•×ª ××¤×©×¨×™×•×ª:
"""</span>)
        <span class="keyword">for</span> j, comp <span class="keyword">in</span> enumerate(conflict.compromises, <span class="number">1</span>):
            parts.append(f<span class="string">"  {j}. {comp}"</span>)

    parts.append(<span class="string">"\n\n××™×–×” ××¡×œ×•×œ ×¤×©×¨×” ××ª××™× ×œ×š?"</span>)
    <span class="keyword">return</span> <span class="string">"\n"</span>.join(parts)</code></pre>

            <h3>nodes/pattern.py - ×‘×—×™×¨×ª Pattern</h3>
            <div class="node-card">
                <h4>ğŸ—ï¸ PatternNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×”×¦×™×¢ 2-3 Patterns ××ª××™××™× ×¢× × ×™×§×•×“.</p>
                <p><strong>×§×œ×˜:</strong> Context ××œ× ×¢× ×¢×“×™×¤×•×™×•×ª ×•×§×•× ×¤×œ×™×§×˜×™× ×¤×ª×•×¨×™×</p>
                <p><strong>×¤×œ×˜:</strong> Shortlist ×©×œ Patterns ×¢× trade-offs</p>
            </div>
            <pre><code><span class="keyword">from</span> <span class="variable">..knowledge.patterns</span> <span class="keyword">import</span> PATTERNS
<span class="keyword">from</span> <span class="variable">..knowledge.decision_matrix</span> <span class="keyword">import</span> score_pattern


<span class="keyword">async def</span> <span class="function">pattern_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str]:
    <span class="string">"""
    ×‘×—×™×¨×ª Pattern ××¨×›×™×˜×§×˜×•× ×™.
    ××©×ª××© ×‘-Scoring + LLM ×œ×‘×—×™×¨×” ××•×©×›×œ×ª.
    """</span>
    <span class="comment"># ×©×œ×‘ 1: Scoring ××ª××˜×™</span>
    scored_patterns = []
    <span class="keyword">for</span> pattern_name, pattern_data <span class="keyword">in</span> PATTERNS.items():
        score = score_pattern(
            pattern=pattern_data,
            priorities=ctx.priority_ranking,
            constraints=ctx.constraints
        )
        scored_patterns.append((pattern_name, score, pattern_data))

    <span class="comment"># ××™×•×Ÿ ×œ×¤×™ × ×™×§×•×“</span>
    scored_patterns.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="keyword">True</span>)

    <span class="comment"># ×©×œ×‘ 2: LLM ×‘×•×—×¨ ××ª×•×š Top 3</span>
    top_3 = scored_patterns[:<span class="number">3</span>]

    prompt = PATTERN_SELECTION_PROMPT.format(
        candidates=[{
            <span class="string">"name"</span>: name,
            <span class="string">"score"</span>: score,
            <span class="string">"pros"</span>: data[<span class="string">"pros"</span>],
            <span class="string">"cons"</span>: data[<span class="string">"cons"</span>]
        } <span class="keyword">for</span> name, score, data <span class="keyword">in</span> top_3],
        context=ctx.model_dump(exclude={<span class="string">"conversation_history"</span>})
    )

    response = <span class="keyword">await</span> llm.generate_structured(
        prompt=prompt,
        response_model=PatternSelection
    )

    <span class="comment"># ×¢×“×›×•×Ÿ ×”-context</span>
    ctx.shortlist = [
        ArchitecturalDecision(
            pattern=name,
            justification=response.justifications.get(name, <span class="string">""</span>),
            trade_offs=data[<span class="string">"cons"</span>],
            score=score
        )
        <span class="keyword">for</span> name, score, data <span class="keyword">in</span> top_3
    ]

    ctx.proposed_architecture = ctx.shortlist[<span class="number">0</span>]  <span class="comment"># ×”×˜×•×‘ ×‘×™×•×ª×¨</span>

    reply = _build_pattern_reply(ctx.shortlist, response.recommendation)
    ctx.add_message(<span class="string">"assistant"</span>, reply)

    <span class="keyword">return</span> ctx, reply</code></pre>

            <h3>nodes/feasibility.py - ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª</h3>
            <div class="node-card">
                <h4>ğŸ’° FeasibilityNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×•×•×“× ×©×”×”××œ×¦×” ××ª××™××” ×œ××¦×™××•×ª.</p>
                <p><strong>×§×œ×˜:</strong> Context ×¢× Pattern ×•-Stack ××•×¦×¢×™×</p>
                <p><strong>×¤×œ×˜:</strong> ×”×¢×¨×›×ª ×¢×œ×•×ª ×•××•×¨×›×‘×•×ª</p>
            </div>
            <pre><code><span class="keyword">async def</span> <span class="function">feasibility_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str]:
    <span class="string">"""
    ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª - ×¢×œ×•×ª ×•××•×¨×›×‘×•×ª.
    """</span>
    prompt = FEASIBILITY_PROMPT.format(
        pattern=ctx.proposed_architecture.pattern,
        tech_stack=[t.model_dump() <span class="keyword">for</span> t <span class="keyword">in</span> ctx.tech_stack],
        constraints=[c.model_dump() <span class="keyword">for</span> c <span class="keyword">in</span> ctx.constraints]
    )

    response = <span class="keyword">await</span> llm.generate_structured(
        prompt=prompt,
        response_model=FeasibilityAssessment
    )

    ctx.feasibility = response

    <span class="comment"># ×‘×“×™×§×ª ×”×ª×××” ×œ××™×œ×•×¦×™×</span>
    warnings = []
    <span class="keyword">for</span> constraint <span class="keyword">in</span> ctx.constraints:
        <span class="keyword">if</span> constraint.type == <span class="string">"budget"</span> <span class="keyword">and</span> response.cost_band == CostBand.HIGH:
            warnings.append(<span class="string">"âš ï¸ ×”×¢×œ×•×ª ×”×¦×¤×•×™×” ×’×‘×•×”×” ×××™×œ×•×¥ ×”×ª×§×¦×™×‘"</span>)
        <span class="keyword">if</span> constraint.type == <span class="string">"team"</span> <span class="keyword">and</span> <span class="keyword">not</span> response.team_fit:
            warnings.append(<span class="string">"âš ï¸ ×”××•×¨×›×‘×•×ª ×¢×©×•×™×” ×œ×”×™×•×ª ×’×‘×•×”×” ××“×™ ×œ×¦×•×•×ª"</span>)

    reply = _build_feasibility_reply(response, warnings)
    ctx.add_message(<span class="string">"assistant"</span>, reply)

    <span class="keyword">return</span> ctx, reply</code></pre>

            <h3>nodes/blueprint.py - ×™×¦×™×¨×ª Blueprint</h3>
            <div class="node-card">
                <h4>ğŸ“„ BlueprintNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×™×™×¦×¨ ××¡××š Blueprint ××§×¦×•×¢×™.</p>
                <p><strong>×§×œ×˜:</strong> Context ××œ× ×¢× ×›×œ ×”×”×—×œ×˜×•×ª</p>
                <p><strong>×¤×œ×˜:</strong> Blueprint ×¢× Mermaid, ADRs, ×•-Roadmap</p>
            </div>
            <pre><code><span class="keyword">async def</span> <span class="function">blueprint_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str]:
    <span class="string">"""
    ×™×¦×™×¨×ª ××¡××š Blueprint ×¡×•×¤×™.
    """</span>
    <span class="comment"># ×™×¦×™×¨×ª ×“×™××’×¨××ª Mermaid</span>
    mermaid = <span class="keyword">await</span> _generate_mermaid(ctx, llm)

    <span class="comment"># ×™×¦×™×¨×ª ADRs</span>
    adrs = <span class="keyword">await</span> _generate_adrs(ctx, llm)

    <span class="comment"># ×™×¦×™×¨×ª Roadmap</span>
    roadmap = <span class="keyword">await</span> _generate_roadmap(ctx, llm)

    <span class="comment"># ×™×¦×™×¨×ª Executive Summary</span>
    summary = <span class="keyword">await</span> _generate_summary(ctx, llm)

    ctx.blueprint = Blueprint(
        executive_summary=summary,
        mermaid_diagram=mermaid,
        adrs=adrs,
        roadmap=roadmap,
        next_steps=<span class="keyword">await</span> _generate_next_steps(ctx, llm),
        assumptions=<span class="keyword">await</span> _extract_assumptions(ctx, llm),
        unknowns=ctx.open_questions
    )

    reply = _format_blueprint_as_markdown(ctx.blueprint)
    ctx.add_message(<span class="string">"assistant"</span>, reply)

    <span class="keyword">return</span> ctx, reply


<span class="keyword">async def</span> <span class="function">_generate_mermaid</span>(ctx: ProjectContext, llm: LLMClient) -> str:
    <span class="string">"""×™×¦×™×¨×ª ×“×™××’×¨××ª Mermaid"""</span>
    prompt = MERMAID_PROMPT.format(
        pattern=ctx.proposed_architecture.pattern,
        tech_stack=[t.technology <span class="keyword">for</span> t <span class="keyword">in</span> ctx.tech_stack]
    )

    response = <span class="keyword">await</span> llm.generate(prompt)

    <span class="comment"># ×•×™×“×•× ×ª×§×™× ×•×ª</span>
    <span class="keyword">if</span> <span class="keyword">not</span> response.startswith(<span class="string">"graph"</span>) <span class="keyword">and</span> <span class="keyword">not</span> response.startswith(<span class="string">"flowchart"</span>):
        response = f<span class="string">"flowchart TD\n{response}"</span>

    <span class="keyword">return</span> response</code></pre>

            <h3>nodes/critic.py - ×‘×™×§×•×¨×ª</h3>
            <div class="node-card">
                <h4>ğŸ” CriticNode</h4>
                <p><strong>××˜×¨×”:</strong> ×œ×‘×“×•×§ ××ª ×”×”××œ×¦×” ×•×œ×”×—×œ×™×˜ ×× ×œ×—×–×•×¨ ××—×•×¨×”.</p>
                <p><strong>×§×œ×˜:</strong> Context ×¢× Blueprint</p>
                <p><strong>×¤×œ×˜:</strong> ××™×©×•×¨ ××• ×”×¤× ×™×” ×œ×©×œ×‘ ×§×•×“×</p>
            </div>
            <pre><code><span class="keyword">async def</span> <span class="function">critic_node</span>(
    ctx: ProjectContext,
    llm: LLMClient
) -> Tuple[ProjectContext, str, Optional[str]]:
    <span class="string">"""
    ×‘×™×§×•×¨×ª ×¢×¦××™×ª - ×‘×•×“×§ ××ª ×”×”××œ×¦×”.
    ××—×–×™×¨ ×’× ××ª ×”×¦×•××ª ×”×‘× (×× ×¦×¨×™×š ×œ×—×–×•×¨ ××—×•×¨×”).
    """</span>
    prompt = CRITIC_PROMPT.format(
        blueprint=ctx.blueprint.model_dump() <span class="keyword">if</span> ctx.blueprint <span class="keyword">else</span> {},
        priorities=ctx.priority_ranking.model_dump() <span class="keyword">if</span> ctx.priority_ranking <span class="keyword">else</span> {},
        constraints=[c.model_dump() <span class="keyword">for</span> c <span class="keyword">in</span> ctx.constraints],
        feasibility=ctx.feasibility.model_dump() <span class="keyword">if</span> ctx.feasibility <span class="keyword">else</span> {}
    )

    response = <span class="keyword">await</span> llm.generate_structured(
        prompt=prompt,
        response_model=CriticAnalysis
    )

    ctx.confidence_score = response.confidence_score
    ctx.iteration_count += <span class="number">1</span>

    next_node = <span class="keyword">None</span>

    <span class="comment"># ×‘×“×™×§×” ×× ×¦×¨×™×š ×œ×—×–×•×¨ ××—×•×¨×”</span>
    <span class="keyword">if</span> response.confidence_score < <span class="number">0.7</span> <span class="keyword">and</span> ctx.iteration_count < ctx.max_iterations:
        <span class="keyword">if</span> response.missing_info:
            next_node = <span class="string">"deep_dive"</span>
            reply = f<span class="string">"ğŸ”„ ×–×™×”×™×ª×™ ×©×—×¡×¨ ××™×“×¢: {response.missing_info}. ×—×•×–×¨ ×œ×©××•×œ ×©××œ×•×ª × ×•×¡×¤×•×ª."</span>
        <span class="keyword">elif</span> response.conflicts:
            next_node = <span class="string">"conflict"</span>
            reply = <span class="string">"ğŸ”„ ×–×™×”×™×ª×™ ×§×•× ×¤×œ×™×§×˜×™× ×—×“×©×™×. ×—×•×–×¨ ×œ×¤×ª×•×¨ ××•×ª×."</span>
        <span class="keyword">else</span>:
            next_node = <span class="string">"pattern"</span>
            reply = <span class="string">"ğŸ”„ ×”-Pattern ×©× ×‘×—×¨ ×œ× ××ª××™× ××¡×¤×™×§. ×‘×•×—×Ÿ ×—×œ×•×¤×•×ª."</span>
    <span class="keyword">elif</span> ctx.iteration_count >= ctx.max_iterations:
        reply = <span class="string">"âš ï¸ ×”×’×¢×ª×™ ×œ××§×¡×™××•× ××™×˜×¨×¦×™×•×ª. ××¦×™×’ ××ª ×”×ª×•×¦××” ×”×˜×•×‘×” ×‘×™×•×ª×¨ ×©×™×© ×œ×™."</span>
    <span class="keyword">else</span>:
        reply = f<span class="string">"âœ… ×‘×™×§×•×¨×ª ×¢×‘×¨×” ×‘×”×¦×œ×—×”! ×¨××ª ×‘×™×˜×—×•×Ÿ: {response.confidence_score:.0%}"</span>

    ctx.add_message(<span class="string">"assistant"</span>, reply)

    <span class="keyword">return</span> ctx, reply, next_node</code></pre>
        </section>

        <!-- Section 6: Graph -->
        <section id="graph">
            <h2>ğŸ”€ 6. ×”×’×“×¨×ª ×”-Graph</h2>

            <h3>graph.py - ×”×¨×›×‘×ª ×”×–×¨×™××”</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">langgraph.graph</span> <span class="keyword">import</span> StateGraph, END
<span class="keyword">from</span> <span class="variable">langgraph.checkpoint.memory</span> <span class="keyword">import</span> MemorySaver

<span class="keyword">from</span> <span class="variable">.state</span> <span class="keyword">import</span> ProjectContext
<span class="keyword">from</span> <span class="variable">.nodes</span> <span class="keyword">import</span> (
    intake_node,
    priority_node,
    conflict_node,
    deep_dive_node,
    pattern_node,
    feasibility_node,
    blueprint_node,
    critic_node
)


<span class="keyword">def</span> <span class="function">create_architect_graph</span>(llm_client):
    <span class="string">"""
    ×™×¦×™×¨×ª ×”-Graph ×©×œ ×”×¡×•×›×Ÿ.
    """</span>
    <span class="comment"># ×™×¦×™×¨×ª ×”-graph ×¢× ×”-state schema</span>
    graph = StateGraph(ProjectContext)

    <span class="comment"># ×”×•×¡×¤×ª ×›×œ ×”-nodes</span>
    <span class="comment"># ×”×¢×¨×”: ×©××•×ª "feasibility" ×•-"blueprint" ×©×•× ×• ×›×“×™ ×œ×× ×•×¢ ×”×ª× ×’×©×•×ª ×¢× ×©×“×•×ª ×‘-state</span>
    graph.add_node(<span class="string">"intake"</span>, <span class="keyword">lambda</span> ctx: intake_node(ctx, llm_client))
    graph.add_node(<span class="string">"priority"</span>, <span class="keyword">lambda</span> ctx: priority_node(ctx, llm_client))
    graph.add_node(<span class="string">"conflict"</span>, <span class="keyword">lambda</span> ctx: conflict_node(ctx, llm_client))
    graph.add_node(<span class="string">"deep_dive"</span>, <span class="keyword">lambda</span> ctx: deep_dive_node(ctx, llm_client))
    graph.add_node(<span class="string">"pattern"</span>, <span class="keyword">lambda</span> ctx: pattern_node(ctx, llm_client))
    graph.add_node(<span class="string">"assess_feasibility"</span>, <span class="keyword">lambda</span> ctx: feasibility_node(ctx, llm_client))
    graph.add_node(<span class="string">"generate_blueprint"</span>, <span class="keyword">lambda</span> ctx: blueprint_node(ctx, llm_client))
    graph.add_node(<span class="string">"critic"</span>, <span class="keyword">lambda</span> ctx: critic_node(ctx, llm_client))

    <span class="comment"># Router node - ××—×œ×™×˜ ×××™×¤×” ×œ×”×ª×—×™×œ ×‘×”×ª×× ×œ-state ×§×™×™×</span>
    graph.add_node(<span class="string">"router"</span>, <span class="keyword">lambda</span> ctx: ctx)

    <span class="comment"># ×”×’×“×¨×ª × ×§×•×“×ª ×”×›× ×™×¡×” (×“×¨×š ×”-router)</span>
    graph.set_entry_point(<span class="string">"router"</span>)

    <span class="comment"># Router edges - ×× ×ª×‘ ×œ× ×§×•×“×ª ×”×ª×—×œ×” ××ª××™××”</span>
    graph.add_conditional_edges(
        <span class="string">"router"</span>,
        _route_entry,
        {
            <span class="string">"intake"</span>: <span class="string">"intake"</span>,
            <span class="string">"priority"</span>: <span class="string">"priority"</span>,
            <span class="string">"deep_dive"</span>: <span class="string">"deep_dive"</span>,
            <span class="string">"assess_feasibility"</span>: <span class="string">"assess_feasibility"</span>,
        }
    )

    <span class="comment"># ×”×’×“×¨×ª ×”××¢×‘×¨×™× (edges)</span>
    graph.add_edge(<span class="string">"intake"</span>, <span class="string">"priority"</span>)
    graph.add_edge(<span class="string">"priority"</span>, <span class="string">"conflict"</span>)
    graph.add_edge(<span class="string">"conflict"</span>, <span class="string">"deep_dive"</span>)
    graph.add_edge(<span class="string">"deep_dive"</span>, <span class="string">"pattern"</span>)
    graph.add_edge(<span class="string">"pattern"</span>, <span class="string">"assess_feasibility"</span>)
    graph.add_edge(<span class="string">"assess_feasibility"</span>, <span class="string">"generate_blueprint"</span>)
    graph.add_edge(<span class="string">"generate_blueprint"</span>, <span class="string">"critic"</span>)

    <span class="comment"># ××¢×‘×¨ ××•×ª× ×” ×-critic</span>
    graph.add_conditional_edges(
        <span class="string">"critic"</span>,
        _route_from_critic,
        {
            <span class="string">"deep_dive"</span>: <span class="string">"deep_dive"</span>,
            <span class="string">"conflict"</span>: <span class="string">"conflict"</span>,
            <span class="string">"pattern"</span>: <span class="string">"pattern"</span>,
            <span class="string">"end"</span>: END
        }
    )

    <span class="comment"># ×§×•××¤×™×œ×¦×™×” ×¢× checkpointer</span>
    checkpointer = MemorySaver()
    compiled = graph.compile(checkpointer=checkpointer)

    <span class="keyword">return</span> compiled


<span class="keyword">def</span> <span class="function">_route_entry</span>(state) -> str:
    <span class="string">"""
    Router ×©××—×œ×™×˜ ×××™×¤×” ×œ×”×ª×—×™×œ/×œ×”××©×™×š.
    ×××¤×©×¨ ×”××©×š ×©×™×—×” ×× ×§×•×“×” ××ª××™××” ×‘××§×•× ×œ×”×ª×—×™×œ ××—×“×©.
    """</span>
    <span class="keyword">if</span> <span class="keyword">isinstance</span>(state, dict):
        state_dict = state
    <span class="keyword">else</span>:
        state_dict = state.model_dump()

    <span class="comment"># ×× ×™×© blueprint - ×××©×™×›×™× ×-deep_dive (×œ×”×•×¡×™×£ ××™×“×¢)</span>
    <span class="keyword">if</span> state_dict.get(<span class="string">"blueprint"</span>):
        <span class="keyword">return</span> <span class="string">"deep_dive"</span>

    <span class="comment"># ×× ×™×© proposed_architecture - ×××©×™×›×™× ×-assess_feasibility</span>
    <span class="keyword">if</span> state_dict.get(<span class="string">"proposed_architecture"</span>):
        <span class="keyword">return</span> <span class="string">"assess_feasibility"</span>

    <span class="comment"># ×× ×™×© requirements - ×××©×™×›×™× ×-priority</span>
    <span class="keyword">if</span> state_dict.get(<span class="string">"requirements"</span>):
        <span class="keyword">return</span> <span class="string">"priority"</span>

    <span class="comment"># ××—×¨×ª - ××ª×—×™×œ×™× ××”×”×ª×—×œ×”</span>
    <span class="keyword">return</span> <span class="string">"intake"</span>


<span class="keyword">def</span> <span class="function">_route_from_critic</span>(ctx: ProjectContext) -> str:
    <span class="string">"""
    ×”×—×œ×˜×” ×œ××Ÿ ×œ×”××©×™×š ××—×¨×™ ×”-critic.

    ×›×œ×œ×™× ×œ×× ×™×¢×ª ×œ×•×¤×™×:
    1. confidence >= 0.7 â†’ ×™×¦×™××” ×¨×’×™×œ×”
    2. 0.5 <= confidence < 0.7 â†’ ×™×¦×™××” ×¢× assumptions
    3. confidence < 0.5 â†’ ×¨×§ ×× ×™×© ×¤×¢×•×œ×” ×¡×¤×¦×™×¤×™×ª ×©×™×›×•×œ×” ×œ×¢×–×•×¨
    4. missing_info â†’ ××—×›×™× ×œ××©×ª××©, ×œ× ×—×•×–×¨×™× ××—×•×¨×”
    5. revision_count >= 2 â†’ ××¡×™×™××™× ×¢× ××” ×©×™×©
    """</span>
    <span class="comment"># ×›×œ×œ 1: ×× ×¡×™×™×× ×• - ×™×•×¦××™×</span>
    <span class="keyword">if</span> ctx.is_done():
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×›×œ×œ 2: ×”×’×‘×œ×ª ××™×˜×¨×¦×™×•×ª</span>
    <span class="keyword">if</span> ctx.iteration_count >= ctx.max_iterations:
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×›×œ×œ 3: confidence ×’×‘×•×” - ×™×¦×™××” ×¨×’×™×œ×”</span>
    <span class="keyword">if</span> ctx.confidence_score >= <span class="number">0.7</span>:
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×›×œ×œ 4: confidence ×‘×™× ×•× ×™ (0.5-0.7) - ×™×¦×™××” ×¢× assumptions</span>
    <span class="keyword">if</span> ctx.confidence_score >= <span class="number">0.5</span>:
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×›×œ×œ 5: ×× ×—×¡×¨ ××™×“×¢ - ××—×›×™× ×œ××©×ª××©</span>
    <span class="keyword">if</span> ctx.last_confidence_reason == <span class="string">"missing_info"</span>:
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×›×œ×œ 6: ×× ×¢×‘×¨× ×• 2 revisions - ××¡×¤×™×§</span>
    <span class="keyword">if</span> ctx.revision_count >= <span class="number">2</span>:
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×›×œ×œ 7: ×× ×”-pattern ×œ× ×”×©×ª× ×” - ××™×Ÿ ×˜×¢× ×œ×—×–×•×¨</span>
    current_pattern = ctx.proposed_architecture.pattern <span class="keyword">if</span> ctx.proposed_architecture <span class="keyword">else</span> <span class="keyword">None</span>
    <span class="keyword">if</span> current_pattern <span class="keyword">and</span> current_pattern == ctx.last_pattern:
        <span class="keyword">return</span> <span class="string">"end"</span>

    <span class="comment"># ×× ×™×© conflicts ×œ× ×¤×ª×•×¨×™× - × ×¡×” ×œ×¤×ª×•×¨ (×¤×¢× ××—×ª)</span>
    <span class="keyword">if</span> ctx.has_unresolved_conflicts() <span class="keyword">and</span> ctx.revision_count < <span class="number">1</span>:
        <span class="keyword">return</span> <span class="string">"conflict"</span>

    <span class="comment"># ×‘×¨×™×¨×ª ××—×“×œ - ××¡×™×™××™×</span>
    <span class="keyword">return</span> <span class="string">"end"</span>


<span class="comment"># ×©×™××•×©</span>
<span class="keyword">async def</span> <span class="function">run_agent</span>(initial_message: str, session_id: str):
    <span class="string">"""×”×¨×¦×ª ×”×¡×•×›×Ÿ ×¢×œ ×”×•×“×¢×”"""</span>
    <span class="keyword">from</span> <span class="variable">.llm.client</span> <span class="keyword">import</span> create_llm_client

    llm = create_llm_client()
    graph = create_architect_graph(llm)

    initial_state = ProjectContext(
        session_id=session_id,
        initial_summary=initial_message
    )
    initial_state.add_message(<span class="string">"user"</span>, initial_message)

    config = {<span class="string">"configurable"</span>: {<span class="string">"thread_id"</span>: session_id}}

    result = <span class="keyword">await</span> graph.ainvoke(initial_state, config)

    <span class="keyword">return</span> result</code></pre>

            <div class="alert-box alert-info">
                <span style="font-size: 1.5em;">ğŸ’¡</span>
                <div>
                    <strong>Checkpointing:</strong> ×”-<code>MemorySaver</code> ×©×•××¨ ××ª ×”-state ×‘×™×Ÿ ×”×¨×¦×•×ª.
                    ×‘×¤×¨×•×“×§×©×Ÿ, ×”×—×œ×£ ×‘-<code>MongoDBSaver</code> ×œ×©××™×¨×” persistent.
                </div>
            </div>
        </section>

        <!-- Section 7: MongoDB -->
        <section id="mongodb">
            <h2>ğŸ—„ï¸ 7. ×©×›×‘×ª MongoDB</h2>

            <h3>db/mongodb.py - ×”×—×™×‘×•×¨</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">motor.motor_asyncio</span> <span class="keyword">import</span> AsyncIOMotorClient
<span class="keyword">from</span> <span class="variable">pymongo</span> <span class="keyword">import</span> IndexModel, ASCENDING, DESCENDING
<span class="keyword">from</span> <span class="variable">typing</span> <span class="keyword">import</span> Optional
<span class="keyword">import</span> <span class="variable">logging</span>

<span class="keyword">from</span> <span class="variable">..config</span> <span class="keyword">import</span> settings

logger = logging.getLogger(__name__)


<span class="keyword">class</span> <span class="class-name">MongoDB</span>:
    <span class="string">"""
    MongoDB client wrapper ×¢× connection pooling.
    """</span>

    client: Optional[AsyncIOMotorClient] = <span class="keyword">None</span>
    db = <span class="keyword">None</span>

    <span class="decorator">@classmethod</span>
    <span class="keyword">async def</span> <span class="function">connect</span>(cls):
        <span class="string">"""×™×¦×™×¨×ª ×—×™×‘×•×¨ ×œ-MongoDB"""</span>
        <span class="keyword">if</span> cls.client <span class="keyword">is</span> <span class="keyword">None</span>:
            cls.client = AsyncIOMotorClient(
                settings.MONGODB_URI,
                maxPoolSize=settings.MONGODB_MAX_POOL_SIZE,
                minPoolSize=settings.MONGODB_MIN_POOL_SIZE,
                serverSelectionTimeoutMS=<span class="number">5000</span>
            )
            cls.db = cls.client[settings.MONGODB_DB_NAME]

            <span class="comment"># ×™×¦×™×¨×ª indexes</span>
            <span class="keyword">await</span> cls._create_indexes()

            logger.info(<span class="string">"Connected to MongoDB"</span>)

    <span class="decorator">@classmethod</span>
    <span class="keyword">async def</span> <span class="function">disconnect</span>(cls):
        <span class="string">"""×¡×’×™×¨×ª ×”×—×™×‘×•×¨"""</span>
        <span class="keyword">if</span> cls.client:
            cls.client.close()
            cls.client = <span class="keyword">None</span>
            logger.info(<span class="string">"Disconnected from MongoDB"</span>)

    <span class="decorator">@classmethod</span>
    <span class="keyword">async def</span> <span class="function">_create_indexes</span>(cls):
        <span class="string">"""×™×¦×™×¨×ª indexes × ×“×¨×©×™×"""</span>
        <span class="comment"># Sessions collection</span>
        sessions = cls.db.sessions
        <span class="keyword">await</span> sessions.create_indexes([
            IndexModel([(<span class="string">"session_id"</span>, ASCENDING)], unique=<span class="keyword">True</span>),
            IndexModel([(<span class="string">"created_at"</span>, DESCENDING)]),
            IndexModel(
                [(<span class="string">"updated_at"</span>, ASCENDING)],
                expireAfterSeconds=<span class="number">86400</span> * <span class="number">30</span>  <span class="comment"># TTL: 30 ×™××™×</span>
            )
        ])

        <span class="comment"># Blueprints collection</span>
        blueprints = cls.db.blueprints
        <span class="keyword">await</span> blueprints.create_indexes([
            IndexModel([(<span class="string">"session_id"</span>, ASCENDING)]),
            IndexModel([(<span class="string">"project_name"</span>, ASCENDING)]),
            IndexModel([(<span class="string">"created_at"</span>, DESCENDING)])
        ])

        <span class="comment"># Patterns knowledge collection</span>
        patterns = cls.db.patterns
        <span class="keyword">await</span> patterns.create_indexes([
            IndexModel([(<span class="string">"name"</span>, ASCENDING)], unique=<span class="keyword">True</span>)
        ])

    <span class="decorator">@classmethod</span>
    <span class="keyword">def</span> <span class="function">get_collection</span>(cls, name: str):
        <span class="string">"""×§×‘×œ×ª collection"""</span>
        <span class="keyword">if</span> cls.db <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="keyword">raise</span> RuntimeError(<span class="string">"Database not connected"</span>)
        <span class="keyword">return</span> cls.db[name]


<span class="comment"># Dependency injection ×œ-FastAPI</span>
<span class="keyword">async def</span> <span class="function">get_db</span>():
    <span class="string">"""Dependency ×œ×”×–×¨×§×ª DB"""</span>
    <span class="keyword">if</span> MongoDB.client <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="keyword">await</span> MongoDB.connect()
    <span class="keyword">return</span> MongoDB</code></pre>

            <h3>db/repositories.py - ×©×›×‘×ª Data Access</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">typing</span> <span class="keyword">import</span> Optional, List
<span class="keyword">from</span> <span class="variable">datetime</span> <span class="keyword">import</span> datetime
<span class="keyword">import</span> <span class="variable">uuid</span>

<span class="keyword">from</span> <span class="variable">.mongodb</span> <span class="keyword">import</span> MongoDB
<span class="keyword">from</span> <span class="variable">..agent.state</span> <span class="keyword">import</span> ProjectContext, Blueprint


<span class="keyword">class</span> <span class="class-name">SessionRepository</span>:
    <span class="string">"""Repository ×œ-Sessions"""</span>

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">create</span>(initial_message: str) -> ProjectContext:
        <span class="string">"""×™×¦×™×¨×ª session ×—×“×©"""</span>
        session_id = str(uuid.uuid4())
        ctx = ProjectContext(
            session_id=session_id,
            initial_summary=initial_message
        )
        ctx.add_message(<span class="string">"user"</span>, initial_message)

        collection = MongoDB.get_collection(<span class="string">"sessions"</span>)
        <span class="keyword">await</span> collection.insert_one(ctx.model_dump())

        <span class="keyword">return</span> ctx

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">get</span>(session_id: str) -> Optional[ProjectContext]:
        <span class="string">"""×§×‘×œ×ª session ×œ×¤×™ ID"""</span>
        collection = MongoDB.get_collection(<span class="string">"sessions"</span>)
        doc = <span class="keyword">await</span> collection.find_one({<span class="string">"session_id"</span>: session_id})

        <span class="keyword">if</span> doc:
            <span class="keyword">return</span> ProjectContext(**doc)
        <span class="keyword">return</span> <span class="keyword">None</span>

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">update</span>(ctx: ProjectContext) -> bool:
        <span class="string">"""×¢×“×›×•×Ÿ session"""</span>
        ctx.updated_at = datetime.utcnow()

        collection = MongoDB.get_collection(<span class="string">"sessions"</span>)
        result = <span class="keyword">await</span> collection.replace_one(
            {<span class="string">"session_id"</span>: ctx.session_id},
            ctx.model_dump()
        )

        <span class="keyword">return</span> result.modified_count > <span class="number">0</span>

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">add_message</span>(session_id: str, role: str, content: str):
        <span class="string">"""×”×•×¡×¤×ª ×”×•×“×¢×” ×œ-session"""</span>
        collection = MongoDB.get_collection(<span class="string">"sessions"</span>)
        <span class="keyword">await</span> collection.update_one(
            {<span class="string">"session_id"</span>: session_id},
            {
                <span class="string">"$push"</span>: {
                    <span class="string">"conversation_history"</span>: {
                        <span class="string">"role"</span>: role,
                        <span class="string">"content"</span>: content,
                        <span class="string">"timestamp"</span>: datetime.utcnow().isoformat()
                    }
                },
                <span class="string">"$set"</span>: {<span class="string">"updated_at"</span>: datetime.utcnow()}
            }
        )


<span class="keyword">class</span> <span class="class-name">BlueprintRepository</span>:
    <span class="string">"""Repository ×œ-Blueprints"""</span>

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">save</span>(session_id: str, blueprint: Blueprint, project_name: str):
        <span class="string">"""×©××™×¨×ª Blueprint"""</span>
        collection = MongoDB.get_collection(<span class="string">"blueprints"</span>)

        doc = {
            <span class="string">"session_id"</span>: session_id,
            <span class="string">"project_name"</span>: project_name,
            <span class="string">"blueprint"</span>: blueprint.model_dump(),
            <span class="string">"created_at"</span>: datetime.utcnow()
        }

        <span class="keyword">await</span> collection.insert_one(doc)

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">get_by_session</span>(session_id: str) -> Optional[Blueprint]:
        <span class="string">"""×§×‘×œ×ª Blueprint ×œ×¤×™ session"""</span>
        collection = MongoDB.get_collection(<span class="string">"blueprints"</span>)
        doc = <span class="keyword">await</span> collection.find_one(
            {<span class="string">"session_id"</span>: session_id},
            sort=[(<span class="string">"created_at"</span>, -<span class="number">1</span>)]
        )

        <span class="keyword">if</span> doc:
            <span class="keyword">return</span> Blueprint(**doc[<span class="string">"blueprint"</span>])
        <span class="keyword">return</span> <span class="keyword">None</span>

    <span class="decorator">@staticmethod</span>
    <span class="keyword">async def</span> <span class="function">list_recent</span>(limit: int = <span class="number">10</span>) -> List[dict]:
        <span class="string">"""×¨×©×™××ª Blueprints ××—×¨×•× ×™×"""</span>
        collection = MongoDB.get_collection(<span class="string">"blueprints"</span>)
        cursor = collection.find(
            {},
            {<span class="string">"session_id"</span>: <span class="number">1</span>, <span class="string">"project_name"</span>: <span class="number">1</span>, <span class="string">"created_at"</span>: <span class="number">1</span>}
        ).sort(<span class="string">"created_at"</span>, -<span class="number">1</span>).limit(limit)

        <span class="keyword">return</span> <span class="keyword">await</span> cursor.to_list(length=limit)</code></pre>

            <h3>Collections Schema</h3>
            <table>
                <thead>
                    <tr>
                        <th>Collection</th>
                        <th>×ª×™××•×¨</th>
                        <th>Indexes</th>
                        <th>TTL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>sessions</code></td>
                        <td>×©×™×—×•×ª ×•×”-State ×©×œ×”×Ÿ</td>
                        <td>session_id (unique), created_at, updated_at</td>
                        <td>30 ×™××™×</td>
                    </tr>
                    <tr>
                        <td><code>blueprints</code></td>
                        <td>××¡××›×™ Blueprint ×©×”×•×¤×§×•</td>
                        <td>session_id, project_name, created_at</td>
                        <td>×œ×œ×</td>
                    </tr>
                    <tr>
                        <td><code>patterns</code></td>
                        <td>×™×“×¢ ×¢×œ Patterns</td>
                        <td>name (unique)</td>
                        <td>×œ×œ×</td>
                    </tr>
                    <tr>
                        <td><code>tech_stacks</code></td>
                        <td>×™×“×¢ ×¢×œ ×˜×›× ×•×œ×•×’×™×•×ª</td>
                        <td>category, name</td>
                        <td>×œ×œ×</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Section 8: API -->
        <section id="api">
            <h2>ğŸŒ 8. API Endpoints</h2>

            <h3>api/main.py - ××¤×œ×™×§×¦×™×™×ª FastAPI</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">fastapi</span> <span class="keyword">import</span> FastAPI
<span class="keyword">from</span> <span class="variable">fastapi.middleware.cors</span> <span class="keyword">import</span> CORSMiddleware
<span class="keyword">from</span> <span class="variable">contextlib</span> <span class="keyword">import</span> asynccontextmanager

<span class="keyword">from</span> <span class="variable">.routes</span> <span class="keyword">import</span> router
<span class="keyword">from</span> <span class="variable">.websocket</span> <span class="keyword">import</span> ws_router
<span class="keyword">from</span> <span class="variable">..db.mongodb</span> <span class="keyword">import</span> MongoDB
<span class="keyword">from</span> <span class="variable">..config</span> <span class="keyword">import</span> settings


<span class="decorator">@asynccontextmanager</span>
<span class="keyword">async def</span> <span class="function">lifespan</span>(app: FastAPI):
    <span class="string">"""Lifecycle management"""</span>
    <span class="comment"># Startup</span>
    <span class="keyword">await</span> MongoDB.connect()
    <span class="keyword">yield</span>
    <span class="comment"># Shutdown</span>
    <span class="keyword">await</span> MongoDB.disconnect()


app = FastAPI(
    title=<span class="string">"Architect Agent API"</span>,
    description=<span class="string">"AI-powered software architecture advisor"</span>,
    version=<span class="string">"1.0.0"</span>,
    lifespan=lifespan
)

<span class="comment"># CORS</span>
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=<span class="keyword">True</span>,
    allow_methods=[<span class="string">"*"</span>],
    allow_headers=[<span class="string">"*"</span>]
)

<span class="comment"># Routes</span>
app.include_router(router, prefix=<span class="string">"/api/v1"</span>)
app.include_router(ws_router, prefix=<span class="string">"/ws"</span>)


<span class="decorator">@app.get</span>(<span class="string">"/health"</span>)
<span class="keyword">async def</span> <span class="function">health_check</span>():
    <span class="keyword">return</span> {<span class="string">"status"</span>: <span class="string">"healthy"</span>}</code></pre>

            <h3>api/routes.py - REST Endpoints</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">fastapi</span> <span class="keyword">import</span> APIRouter, HTTPException, Depends
<span class="keyword">from</span> <span class="variable">pydantic</span> <span class="keyword">import</span> BaseModel

<span class="keyword">from</span> <span class="variable">..db.repositories</span> <span class="keyword">import</span> SessionRepository, BlueprintRepository
<span class="keyword">from</span> <span class="variable">..agent.graph</span> <span class="keyword">import</span> run_agent

router = APIRouter()


<span class="keyword">class</span> <span class="class-name">CreateSessionRequest</span>(BaseModel):
    message: str


<span class="keyword">class</span> <span class="class-name">ChatRequest</span>(BaseModel):
    message: str


<span class="decorator">@router.post</span>(<span class="string">"/sessions"</span>)
<span class="keyword">async def</span> <span class="function">create_session</span>(request: CreateSessionRequest):
    <span class="string">"""×™×¦×™×¨×ª session ×—×“×© ×•×”×¨×¦×ª ×”×¡×•×›×Ÿ"""</span>
    ctx = <span class="keyword">await</span> SessionRepository.create(request.message)

    <span class="comment"># ×”×¨×¦×ª ×”×¡×•×›×Ÿ</span>
    result = <span class="keyword">await</span> run_agent(request.message, ctx.session_id)

    <span class="comment"># ×¢×“×›×•×Ÿ ×”-session</span>
    <span class="keyword">await</span> SessionRepository.update(result)

    <span class="keyword">return</span> {
        <span class="string">"session_id"</span>: ctx.session_id,
        <span class="string">"response"</span>: result.conversation_history[-<span class="number">1</span>][<span class="string">"content"</span>],
        <span class="string">"current_node"</span>: result.current_node,
        <span class="string">"confidence"</span>: result.confidence_score
    }


<span class="decorator">@router.get</span>(<span class="string">"/sessions/{session_id}"</span>)
<span class="keyword">async def</span> <span class="function">get_session</span>(session_id: str):
    <span class="string">"""×§×‘×œ×ª ×¤×¨×˜×™ session"""</span>
    ctx = <span class="keyword">await</span> SessionRepository.get(session_id)
    <span class="keyword">if</span> <span class="keyword">not</span> ctx:
        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">"Session not found"</span>)

    <span class="keyword">return</span> {
        <span class="string">"session_id"</span>: ctx.session_id,
        <span class="string">"project_name"</span>: ctx.project_name,
        <span class="string">"current_node"</span>: ctx.current_node,
        <span class="string">"confidence"</span>: ctx.confidence_score,
        <span class="string">"is_done"</span>: ctx.is_done(),
        <span class="string">"history"</span>: ctx.conversation_history
    }


<span class="decorator">@router.post</span>(<span class="string">"/sessions/{session_id}/chat"</span>)
<span class="keyword">async def</span> <span class="function">chat</span>(session_id: str, request: ChatRequest):
    <span class="string">"""×”××©×š ×©×™×—×” ×§×™×™××ª"""</span>
    ctx = <span class="keyword">await</span> SessionRepository.get(session_id)
    <span class="keyword">if</span> <span class="keyword">not</span> ctx:
        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">"Session not found"</span>)

    <span class="comment"># ×”×•×¡×¤×ª ×”×”×•×“×¢×”</span>
    ctx.add_message(<span class="string">"user"</span>, request.message)

    <span class="comment"># ×”××©×š ×”×¨×¦×ª ×”×¡×•×›×Ÿ</span>
    result = <span class="keyword">await</span> run_agent(request.message, session_id)

    <span class="comment"># ×¢×“×›×•×Ÿ</span>
    <span class="keyword">await</span> SessionRepository.update(result)

    <span class="keyword">return</span> {
        <span class="string">"response"</span>: result.conversation_history[-<span class="number">1</span>][<span class="string">"content"</span>],
        <span class="string">"current_node"</span>: result.current_node,
        <span class="string">"confidence"</span>: result.confidence_score,
        <span class="string">"is_done"</span>: result.is_done()
    }


<span class="decorator">@router.get</span>(<span class="string">"/sessions/{session_id}/blueprint"</span>)
<span class="keyword">async def</span> <span class="function">get_blueprint</span>(session_id: str):
    <span class="string">"""×§×‘×œ×ª ×”-Blueprint ×©×”×•×¤×§"""</span>
    ctx = <span class="keyword">await</span> SessionRepository.get(session_id)
    <span class="keyword">if</span> <span class="keyword">not</span> ctx <span class="keyword">or not</span> ctx.blueprint:
        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">"Blueprint not found"</span>)

    <span class="keyword">return</span> ctx.blueprint.model_dump()


<span class="decorator">@router.get</span>(<span class="string">"/blueprints"</span>)
<span class="keyword">async def</span> <span class="function">list_blueprints</span>(limit: int = <span class="number">10</span>):
    <span class="string">"""×¨×©×™××ª Blueprints ××—×¨×•× ×™×"""</span>
    <span class="keyword">return</span> <span class="keyword">await</span> BlueprintRepository.list_recent(limit)</code></pre>
        </section>

        <!-- Section 9: Config -->
        <section id="config">
            <h2>âš™ï¸ 9. ×§×•× ×¤×™×’×•×¨×¦×™×” ×•-Environment</h2>

            <h3>config.py</h3>
            <pre><code><span class="keyword">from</span> <span class="variable">pydantic_settings</span> <span class="keyword">import</span> BaseSettings
<span class="keyword">from</span> <span class="variable">typing</span> <span class="keyword">import</span> List
<span class="keyword">from</span> <span class="variable">functools</span> <span class="keyword">import</span> lru_cache


<span class="keyword">class</span> <span class="class-name">Settings</span>(BaseSettings):
    <span class="string">"""Application settings"""</span>

    <span class="comment"># App</span>
    APP_NAME: str = <span class="string">"Architect Agent"</span>
    DEBUG: bool = <span class="keyword">False</span>

    <span class="comment"># MongoDB</span>
    MONGODB_URI: str
    MONGODB_DB_NAME: str = <span class="string">"architect_agent"</span>
    MONGODB_MAX_POOL_SIZE: int = <span class="number">10</span>
    MONGODB_MIN_POOL_SIZE: int = <span class="number">1</span>

    <span class="comment"># Claude API</span>
    ANTHROPIC_API_KEY: str
    CLAUDE_MODEL: str = <span class="string">"claude-sonnet-4-20250514"</span>
    CLAUDE_MAX_TOKENS: int = <span class="number">4096</span>

    <span class="comment"># Redis (optional)</span>
    REDIS_URL: str = <span class="string">""</span>

    <span class="comment"># CORS</span>
    CORS_ORIGINS: List[str] = [<span class="string">"*"</span>]

    <span class="comment"># Agent</span>
    MAX_ITERATIONS: int = <span class="number">5</span>
    MIN_CONFIDENCE: float = <span class="number">0.7</span>

    <span class="keyword">class</span> <span class="class-name">Config</span>:
        env_file = <span class="string">".env"</span>
        case_sensitive = <span class="keyword">True</span>


<span class="decorator">@lru_cache</span>()
<span class="keyword">def</span> <span class="function">get_settings</span>() -> Settings:
    <span class="keyword">return</span> Settings()


settings = get_settings()</code></pre>

            <h3>.env.example</h3>
            <pre><code><span class="comment"># MongoDB</span>
MONGODB_URI=mongodb+srv://user:password@cluster.mongodb.net/?retryWrites=true&w=majority
MONGODB_DB_NAME=architect_agent

<span class="comment"># Claude API</span>
ANTHROPIC_API_KEY=sk-ant-api...

<span class="comment"># Optional: Redis for caching</span>
REDIS_URL=redis://localhost:6379

<span class="comment"># CORS (comma separated)</span>
CORS_ORIGINS=https://your-app.com,http://localhost:3000

<span class="comment"># Agent settings</span>
MAX_ITERATIONS=5
MIN_CONFIDENCE=0.7</code></pre>

            <h3>Environment Variables ×‘-Render</h3>
            <table class="env-table">
                <thead>
                    <tr>
                        <th>××©×ª× ×”</th>
                        <th>×ª×™××•×¨</th>
                        <th>×—×•×‘×”</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>MONGODB_URI</td>
                        <td>Connection string ×œ-MongoDB Atlas</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td>ANTHROPIC_API_KEY</td>
                        <td>××¤×ª×— API ×©×œ Anthropic</td>
                        <td>âœ…</td>
                    </tr>
                    <tr>
                        <td>MONGODB_DB_NAME</td>
                        <td>×©× ×”-Database</td>
                        <td>âŒ (×‘×¨×™×¨×ª ××—×“×œ: architect_agent)</td>
                    </tr>
                    <tr>
                        <td>REDIS_URL</td>
                        <td>URL ×œ-Redis (××•×¤×¦×™×•× ×œ×™)</td>
                        <td>âŒ</td>
                    </tr>
                    <tr>
                        <td>CORS_ORIGINS</td>
                        <td>×“×•××™×™× ×™× ××•×¨×©×™×</td>
                        <td>âŒ</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Section 10: Render -->
        <section id="render">
            <h2>ğŸš€ 10. ×¤×¨×™×¡×” ×‘-Render</h2>

            <h3>render.yaml - ×ª×¦×•×¨×ª Blueprint</h3>
            <pre><code><span class="comment"># render.yaml - Infrastructure as Code</span>

services:
  - type: web
    name: architect-agent-api
    runtime: python
    region: frankfurt  <span class="comment"># ××• oregon</span>
    plan: starter  <span class="comment"># ××• standard ×œ×¤×¨×•×“×§×©×Ÿ</span>

    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn src.api.main:app --host 0.0.0.0 --port $PORT

    healthCheckPath: /health

    envVars:
      - key: MONGODB_URI
        sync: false  <span class="comment"># ×”×’×“×¨×” ×™×“× ×™×ª ×‘-Dashboard</span>
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: MONGODB_DB_NAME
        value: architect_agent
      - key: PYTHON_VERSION
        value: "3.11"

    autoDeploy: true  <span class="comment"># deploy ××•×˜×•××˜×™ ×-GitHub</span></code></pre>

            <h3>requirements.txt</h3>
            <pre><code><span class="comment"># Core</span>
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.3
pydantic-settings==2.1.0

<span class="comment"># LangGraph & LLM</span>
langgraph==0.0.43
langchain-anthropic==0.1.4
anthropic==0.18.1

<span class="comment"># Database</span>
motor==3.3.2
pymongo==4.6.1

<span class="comment"># Optional: Redis</span>
redis==5.0.1

<span class="comment"># Utilities</span>
python-dotenv==1.0.0
httpx==0.26.0</code></pre>

            <h3>×¦×¢×“×™ ×¤×¨×™×¡×”</h3>
            <div class="alert-box alert-success">
                <span style="font-size: 1.5em;">âœ…</span>
                <div>
                    <strong>×©×œ×‘×™×:</strong>
                    <ol>
                        <li>×¦×•×¨ ×—×©×‘×•×Ÿ ×‘-<a href="https://render.com" style="color: var(--primary-color);">Render</a> ×•-<a href="https://mongodb.com/atlas" style="color: var(--primary-color);">MongoDB Atlas</a></li>
                        <li>×‘-Atlas: ×¦×•×¨ Cluster ×—×™× ××™, ×”×•×¡×£ IP <code>0.0.0.0/0</code> ×œ-Network Access</li>
                        <li>×‘-Render: ×—×‘×¨ ××ª ×”-GitHub repo</li>
                        <li>×”×’×“×¨ ××ª ×”-Environment Variables</li>
                        <li>×œ×—×¥ Deploy!</li>
                    </ol>
                </div>
            </div>

            <h3>Dockerfile (××•×¤×¦×™×•× ×œ×™)</h3>
            <pre><code>FROM python:3.11-slim

WORKDIR /app

<span class="comment"># Install dependencies</span>
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

<span class="comment"># Copy source code</span>
COPY src/ ./src/

<span class="comment"># Run</span>
EXPOSE 8000
CMD ["uvicorn", "src.api.main:app", "--host", "0.0.0.0", "--port", "8000"]</code></pre>
        </section>

        <!-- Section 11: ADRs -->
        <section id="adrs">
            <h2>ğŸ“ 11. ADRs - ×”×—×œ×˜×•×ª ××¨×›×™×˜×§×˜×•× ×™×•×ª</h2>

            <div class="adr-card">
                <h4>ADR-001: ×‘×—×™×¨×ª LangGraph ×›-Orchestrator</h4>
                <p><strong>Context:</strong> ×¦×¨×™×š framework ×œ× ×™×”×•×œ ×–×¨×™××ª ×¢×‘×•×“×” ××•×¨×›×‘×ª ×¢× state, ××¢×‘×¨×™× ××•×ª× ×™×, ×•××¤×©×¨×•×ª ×œ×—×–×•×¨ ××—×•×¨×”.</p>
                <p><strong>Decision:</strong> ×©×™××•×© ×‘-LangGraph ×‘××§×•× LangChain ×¨×’×™×œ ××• ×¤×ª×¨×•×Ÿ custom.</p>
                <p><strong>Consequences:</strong></p>
                <ul>
                    <li>âœ… State management ××•×‘× ×”</li>
                    <li>âœ… Checkpointing ××•×˜×•××˜×™</li>
                    <li>âœ… Debugging ×•-Visualization</li>
                    <li>âš ï¸ ×ª×œ×•×ª ×‘-LangChain ecosystem</li>
                </ul>
            </div>

            <div class="adr-card">
                <h4>ADR-002: MongoDB ×›-Database ×¨××©×™</h4>
                <p><strong>Context:</strong> ×¦×¨×™×š ×œ×©××•×¨ State ××•×¨×›×‘ ×•××§×•× ×Ÿ, ×¢× ×’××™×©×•×ª ×‘-Schema.</p>
                <p><strong>Decision:</strong> MongoDB ×‘××§×•× PostgreSQL.</p>
                <p><strong>Consequences:</strong></p>
                <ul>
                    <li>âœ… Schema ×’××™×© - ××ª××™× ×œ-ProjectContext</li>
                    <li>âœ… TTL indexes ×œ× ×™×§×•×™ ××•×˜×•××˜×™</li>
                    <li>âœ… MongoDB Atlas - managed service</li>
                    <li>âš ï¸ ××™×Ÿ transactions ×—×–×§×™× ×›××• SQL</li>
                </ul>
            </div>

            <div class="adr-card">
                <h4>ADR-003: Claude ×›-LLM ×¨××©×™</h4>
                <p><strong>Context:</strong> ×¦×¨×™×š LLM ×¢× ×™×›×•×œ×ª reasoning ×—×–×§×” ×•structured output.</p>
                <p><strong>Decision:</strong> Claude Sonnet 4 (claude-sonnet-4-20250514).</p>
                <p><strong>Consequences:</strong></p>
                <ul>
                    <li>âœ… Reasoning ××¢×•×œ×”</li>
                    <li>âœ… Context window ×’×“×•×œ (200K)</li>
                    <li>âœ… ×ª××™×›×” ×˜×•×‘×” ×‘×¢×‘×¨×™×ª</li>
                    <li>âš ï¸ ×¢×œ×•×ª ×’×‘×•×”×” ×™×—×¡×™×ª</li>
                </ul>
            </div>

            <div class="adr-card">
                <h4>ADR-004: Scoring + LLM ×œ×‘×—×™×¨×ª Pattern</h4>
                <p><strong>Context:</strong> ×¦×¨×™×š ×œ×”×—×œ×™×˜ ×¢×œ Pattern ××¨×›×™×˜×§×˜×•× ×™ ×‘×¦×•×¨×” ×¢×§×‘×™×ª ×•×× ×•××§×ª.</p>
                <p><strong>Decision:</strong> ×©×™×œ×•×‘ ×©×œ Scoring ××ª××˜×™ (××©×§×œ×™×) + LLM ×œ×‘×—×™×¨×” ×¡×•×¤×™×ª.</p>
                <p><strong>Consequences:</strong></p>
                <ul>
                    <li>âœ… ×”×—×œ×˜×•×ª ×¢×§×‘×™×•×ª ×•× ×™×ª× ×•×ª ×œ×©×—×–×•×¨</li>
                    <li>âœ… LLM ××•×¡×™×£ ×©×™×§×•×œ ×“×¢×ª ×¢××•×</li>
                    <li>âœ… ×©×§×™×¤×•×ª - ××¤×©×¨ ×œ×”×¦×™×’ ××ª ×”× ×™×§×•×“</li>
                    <li>âš ï¸ ×¦×¨×™×š ×œ×ª×—×–×§ ××ª ××˜×¨×™×¦×ª ×”××©×§×œ×™×</li>
                </ul>
            </div>

            <div class="adr-card">
                <h4>ADR-005: Render ×›-Platform</h4>
                <p><strong>Context:</strong> ×¦×¨×™×š platform ×¤×©×•×˜ ×œ×¤×¨×™×¡×” ×¢× CI/CD ××•×˜×•××˜×™.</p>
                <p><strong>Decision:</strong> Render ×‘××§×•× Vercel/Railway/AWS.</p>
                <p><strong>Consequences:</strong></p>
                <ul>
                    <li>âœ… ×¤×©×˜×•×ª - Git push = Deploy</li>
                    <li>âœ… ×ª××—×•×¨ ×”×•×’×Ÿ</li>
                    <li>âœ… ×ª××™×›×” ×˜×•×‘×” ×‘-Python</li>
                    <li>âš ï¸ ×¤×—×•×ª ×’××™×©×•×ª ×-AWS/GCP</li>
                </ul>
            </div>
        </section>

        <!-- Section 12: Best Practices -->
        <section id="best-practices">
            <h2>ğŸ’ 12. Best Practices ×•×˜×™×¤×™×</h2>

            <div class="grid-2">
                <div class="feature-card">
                    <h4>ğŸ”’ ××‘×˜×—×”</h4>
                    <ul>
                        <li>×©××•×¨ API keys ×‘-Environment Variables ×‘×œ×‘×“</li>
                        <li>×”×’×‘×œ CORS ×œ×“×•××™×™× ×™× ×¡×¤×¦×™×¤×™×™× ×‘×¤×¨×•×“×§×©×Ÿ</li>
                        <li>×”×©×ª××© ×‘-MongoDB Atlas ×¢× IP Whitelist</li>
                        <li>×”×•×¡×£ Rate Limiting ×œ-API</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>âš¡ ×‘×™×¦×•×¢×™×</h4>
                    <ul>
                        <li>×”×©×ª××© ×‘-Redis ×œcaching ×©×œ Patterns × ×¤×•×¦×™×</li>
                        <li>×”×’×‘×œ ××ª ×”×™×¡×˜×•×¨×™×™×ª ×”×©×™×—×” ×œ-10 ×”×•×“×¢×•×ª ××—×¨×•× ×•×ª</li>
                        <li>×”×©×ª××© ×‘-streaming ×œ×ª×’×•×‘×•×ª ××¨×•×›×•×ª</li>
                        <li>×”×•×¡×£ timeout ×œ×§×¨×™××•×ª LLM</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>ğŸ§ª ×‘×“×™×§×•×ª</h4>
                    <ul>
                        <li>×‘×“×•×§ ×›×œ Node ×‘× ×¤×¨×“ ×¢× mock LLM</li>
                        <li>×‘×“×•×§ ××ª ×”×–×¨×™××” ×”××œ××” ×¢× ×ª×¨×—×™×©×™× ×××™×ª×™×™×</li>
                        <li>×”×©×ª××© ×‘-pytest-asyncio</li>
                        <li>×‘×“×•×§ edge cases: ×ª×©×•×‘×•×ª ×§×¦×¨×•×ª, ×¡×ª×™×¨×•×ª ×§×™×¦×•× ×™×•×ª</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“Š Monitoring</h4>
                    <ul>
                        <li>×œ×•×’ ×›×œ ×§×¨×™××ª LLM ×¢× tokens ×•×–××Ÿ</li>
                        <li>×¢×§×•×‘ ××—×¨×™ confidence_score ×××•×¦×¢</li>
                        <li>×”×ª×¨××” ×¢×œ iteration_count ×’×‘×•×”</li>
                        <li>×©××•×¨ ××˜×¨×™×§×•×ª ×œ×©×™×¤×•×¨ ×”-prompts</li>
                    </ul>
                </div>
            </div>

            <h3>×˜×™×¤×™× × ×•×¡×¤×™×</h3>
            <div class="alert-box alert-info">
                <span style="font-size: 1.5em;">ğŸ’¡</span>
                <div>
                    <strong>Prompt Engineering:</strong>
                    <ul>
                        <li>×”×©×ª××© ×‘-few-shot examples ×‘×›×œ prompt</li>
                        <li>×”×’×“×¨ ××ª ×”×¤×•×¨××˜ ×”×¨×¦×•×™ ×‘×‘×™×¨×•×¨ (JSON Schema)</li>
                        <li>×‘×§×© ××”-LLM ×œ×”×¡×‘×™×¨ ××ª ×”×”×—×œ×˜×•×ª ×©×œ×•</li>
                        <li>×”×•×¡×£ "Think step by step" ×œ××©×™××•×ª ××•×¨×›×‘×•×ª</li>
                    </ul>
                </div>
            </div>

            <div class="alert-box alert-warning">
                <span style="font-size: 1.5em;">âš ï¸</span>
                <div>
                    <strong>××œ×›×•×“×•×ª × ×¤×•×¦×•×ª:</strong>
                    <ul>
                        <li>××œ ×ª×©××•×¨ ××ª ×›×œ ×”-conversation_history ×‘-prompt - ×–×” ×™×§×¨</li>
                        <li>××œ ×ª×¡××•×š ×¨×§ ×¢×œ LLM ×œ×‘×—×™×¨×ª Pattern - ×©×œ×‘ Scoring</li>
                        <li>××œ ×ª×©×›×— ×œ×”×’×‘×™×œ iterations - ××¤×©×¨ ×œ×”×™×ª×§×¢ ×‘×œ×•×¤</li>
                        <li>××œ ×ª×ª×¢×œ× ×-confidence_score - ×”×•× ×©× ×œ×¡×™×‘×”</li>
                    </ul>
                </div>
            </div>

            <h3>×”×¨×—×‘×•×ª ×¢×ª×™×“×™×•×ª</h3>
            <ul>
                <li>ğŸ”Œ <strong>RAG Integration:</strong> ×”×•×¡×¤×ª ×™×“×¢ ××¢×•×“×›×Ÿ ××”××™× ×˜×¨× ×˜</li>
                <li>ğŸ“Š <strong>Diagram Generation:</strong> ×™×¦×™×¨×ª ×“×™××’×¨××•×ª ××•×˜×•××˜×™×•×ª ×¢× Mermaid/PlantUML</li>
                <li>ğŸ’¬ <strong>Multi-turn Memory:</strong> ×–×™×›×¨×•×Ÿ ××¨×•×š-×˜×•×•×— ×‘×™×Ÿ sessions</li>
                <li>ğŸ“± <strong>Telegram Bot:</strong> ×××©×§ ×©×™×—×” ×‘×˜×œ×’×¨×</li>
                <li>ğŸ“ˆ <strong>Cost Calculator:</strong> ××™× ×˜×’×¨×¦×™×” ×¢× AWS/GCP pricing API</li>
            </ul>
        </section>

        <!-- Footer -->
        <footer style="text-align: center; padding: 40px; opacity: 0.8;">
            <p>× ×‘× ×” ×¢× â¤ï¸ | ×’×¨×¡×” 1.0 | 2025</p>
            <p style="font-size: 0.9em;">××“×¨×™×š ×–×” × ×•×¦×¨ ×›××¡××š ×¢×¦×××™ ×œ××™××•×© Architect Agent</p>
        </footer>
    </div>

    <script>
        // ×”×•×¡×¤×ª ×›×¤×ª×•×¨×™ ×”×¢×ª×§×” ×œ×›×œ ×‘×œ×•×§×™ ×”×§×•×“
        document.addEventListener('DOMContentLoaded', function() {
            // ××™×™×§×•×Ÿ ×”×¢×ª×§×” (×©× ×™ ×“×¤×™×)
            const copyIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>`;

            // ××™×™×§×•×Ÿ ×•×™ (××—×¨×™ ×”×¢×ª×§×”)
            const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>`;

            // ××•×¦× ××ª ×›×œ ×‘×œ×•×§×™ ×”-pre
            const codeBlocks = document.querySelectorAll('pre');

            codeBlocks.forEach(function(pre) {
                // ×™×•×¦×¨ wrapper
                const wrapper = document.createElement('div');
                wrapper.className = 'code-block';
                wrapper.style.position = 'relative';
                wrapper.style.overflow = 'visible';
                pre.parentNode.insertBefore(wrapper, pre);
                wrapper.appendChild(pre);

                // ×™×•×¦×¨ ×›×¤×ª×•×¨
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerHTML = copyIcon;
                btn.title = '×”×¢×ª×§ ×§×•×“';
                btn.type = 'button';
                wrapper.appendChild(btn);

                // ××™×¨×•×¢ ×œ×—×™×¦×”
                btn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    // ××§×‘×œ ××ª ×”×˜×§×¡×˜ ××ª×•×š ×”-code ××• ×™×©×™×¨×•×ª ××”-pre
                    const code = pre.querySelector('code');
                    const text = code ? code.textContent : pre.textContent;

                    navigator.clipboard.writeText(text).then(function() {
                        // ××©× ×” ×œ××™×™×§×•×Ÿ ×•×™
                        btn.innerHTML = checkIcon;
                        btn.classList.add('copied');

                        // ×—×•×–×¨ ×œ××™×™×§×•×Ÿ ×”×¢×ª×§×” ××—×¨×™ 2 ×©× ×™×•×ª
                        setTimeout(function() {
                            btn.innerHTML = copyIcon;
                            btn.classList.remove('copied');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('Failed to copy:', err);
                        // fallback ×œ×“×¤×“×¤× ×™× ×™×©× ×™×
                        const textarea = document.createElement('textarea');
                        textarea.value = text;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);

                        btn.innerHTML = checkIcon;
                        btn.classList.add('copied');
                        setTimeout(function() {
                            btn.innerHTML = copyIcon;
                            btn.classList.remove('copied');
                        }, 2000);
                    });
                };
            });
        });
    </script>
</body>
</html>
